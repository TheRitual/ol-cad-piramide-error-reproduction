import{c as Mt,a as Ui,b as Fr,g as ht,d as _e,e as dn,f as Ur,h as it,s as nt,l as Gr,i as Xr,k as Gi,n as zr,o as kr,p as Xi,q as jr,t as xn,u as Zr,v as Kr,w as Nt,x as $r,y as $,z as H,A as Yr,B as Cn,C as Br,D as ge,E as Ke,F as $e,G as wn,H as Vr,I as gn,J as Wr,K as fn,L as _n,M as zi,N as Hr,O as ce,P as qr,Q as ii,R as Qr,S as Jr,T as In,U as es,V as ts,W as ns,X as rt,Y as mn,Z as Wt,_ as is,$ as rs,a0 as ss,a1 as ri,a2 as wt,a3 as ki,a4 as _t,a5 as mt,a6 as os,a7 as ke,a8 as as,r as Ht}from"./index-bm5Y1lPt.js";function ct(r){for(const e in r)delete r[e]}function ls(r){let e;for(e in r)return!1;return!e}class Ie{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const st={PROPERTYCHANGE:"propertychange"};class Ft{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function bn(r,e){return r>e?1:r<e?-1:0}function hs(r,e){return r<e?1:r>e?-1:0}function Ln(r,e,t){if(r[0]<=e)return 0;const n=r.length;if(e<=r[n-1])return n-1;if(typeof t=="function"){for(let i=1;i<n;++i){const s=r[i];if(s===e)return i;if(s<e)return t(e,r[i-1],s)>0?i-1:i}return n-1}if(t>0){for(let i=1;i<n;++i)if(r[i]<e)return i-1;return n-1}if(t<0){for(let i=1;i<n;++i)if(r[i]<=e)return i;return n-1}for(let i=1;i<n;++i){if(r[i]==e)return i;if(r[i]<e)return r[i-1]-e<e-r[i]?i-1:i}return n-1}function cs(r,e){const t=Array.isArray(e)?e:[e],n=t.length;for(let i=0;i<n;i++)r[r.length]=t[i]}function An(r,e){const t=r.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(r[n]!==e[n])return!1;return!0}function us(r,e,t){const n=e||bn;return r.every(function(i,s){if(s===0)return!0;const o=n(r[s-1],i);return!(o>0||t&&o===0)})}function It(){return!0}function Ut(){return!1}function bt(){}function ds(r){let e=!1,t,n,i;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==i||!An(s,n))&&(e=!0,i=this,n=s,t=r.apply(this,arguments)),t}}class Gt extends Ft{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const n=this.listeners_||(this.listeners_={}),i=n[e]||(n[e]=[]);i.includes(t)||i.push(t)}dispatchEvent(e){const t=typeof e=="string",n=t?e:e.type,i=this.listeners_&&this.listeners_[n];if(!i)return;const s=t?new Ie(e):e;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,c=i.length;h<c;++h)if("handleEvent"in i[h]?l=i[h].handleEvent(s):l=i[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,bt);delete o[n]}return l}disposeInternal(){this.listeners_&&ct(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const n=this.listeners_[e];if(!n)return;const i=n.indexOf(t);i!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(n[i]=bt,++this.pendingRemovals_[e]):(n.splice(i,1),n.length===0&&delete this.listeners_[e]))}}const S={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function F(r,e,t,n,i){if(n&&n!==r&&(t=t.bind(n)),i){const o=t;t=function(){r.removeEventListener(e,t),o.apply(this,arguments)}}const s={target:r,type:e,listener:t};return r.addEventListener(e,t),s}function Lt(r,e,t,n){return F(r,e,t,n,!0)}function j(r){r&&r.target&&(r.target.removeEventListener(r.type,r.listener),ct(r))}class ut extends Gt{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(S.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const n=e.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=F(this,e[s],t);return i}return F(this,e,t)}onceInternal(e,t){let n;if(Array.isArray(e)){const i=e.length;n=new Array(i);for(let s=0;s<i;++s)n[s]=Lt(this,e[s],t)}else n=Lt(this,e,t);return t.ol_key=n,n}unInternal(e,t){const n=t.ol_key;if(n)gs(n);else if(Array.isArray(e))for(let i=0,s=e.length;i<s;++i)this.removeEventListener(e[i],t);else this.removeEventListener(e,t)}}ut.prototype.on;ut.prototype.once;ut.prototype.un;function gs(r){if(Array.isArray(r))for(let e=0,t=r.length;e<t;++e)j(r[e]);else j(r)}function k(){throw new Error("Unimplemented abstract method.")}let fs=0;function Y(r){return r.ol_uid||(r.ol_uid=String(++fs))}class si extends Ie{constructor(e,t,n){super(e),this.key=t,this.oldValue=n}}class pe extends ut{constructor(e){super(),this.on,this.once,this.un,Y(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let n;n=`change:${e}`,this.hasListener(n)&&this.dispatchEvent(new si(n,e,t)),n=st.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new si(n,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,n){const i=this.values_||(this.values_={});if(n)i[e]=t;else{const s=i[e];i[e]=t,s!==t&&this.notify(e,s)}}setProperties(e,t){for(const n in e)this.set(n,e[n],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const n=this.values_[e];delete this.values_[e],ls(this.values_)&&(this.values_=null),t||this.notify(e,n)}}}const te={ADD:"add",REMOVE:"remove"},oi={LENGTH:"length"};class pt extends Ie{constructor(e,t,n){super(e),this.element=t,this.index=n}}class fe extends pe{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let n=0,i=this.array_.length;n<i;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,n=e.length;t<n;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let n=0,i=t.length;n<i;++n)e(t[n],n,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(oi.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new pt(te.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let n=0,i=t.length;n<i;++n)if(t[n]===e)return this.removeAt(n)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new pt(te.REMOVE,t,e)),t}setAt(e,t){const n=this.getLength();if(e>=n){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const i=this.array_[e];this.array_[e]=t,this.dispatchEvent(new pt(te.REMOVE,i,e)),this.dispatchEvent(new pt(te.ADD,t,e))}updateLength_(){this.set(oi.LENGTH,this.array_.length)}assertUnique_(e,t){for(let n=0,i=this.array_.length;n<i;++n)if(this.array_[n]===e&&n!==t)throw new Error("Duplicate item added to a unique collection")}}function X(r,e){if(!r)throw new Error(e)}const we=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",_s=we.includes("firefox"),ms=we.includes("safari")&&!we.includes("chrom"),ps=ms&&(we.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(we)),Es=we.includes("webkit")&&!we.includes("edge"),ji=we.includes("macintosh"),Zi=typeof devicePixelRatio<"u"?devicePixelRatio:1,ys=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Ts=typeof Image<"u"&&Image.prototype.decode,Ki=function(){let r=!1;try{const e=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return r}(),Sn=new Array(6);function De(){return[1,0,0,1,0,0]}function Rs(r){return Xt(r,1,0,0,1,0,0)}function Pn(r,e){const t=r[0],n=r[1],i=r[2],s=r[3],o=r[4],a=r[5],l=e[0],h=e[1],c=e[2],u=e[3],d=e[4],g=e[5];return r[0]=t*l+i*h,r[1]=n*l+s*h,r[2]=t*c+i*u,r[3]=n*c+s*u,r[4]=t*d+i*g+o,r[5]=n*d+s*g+a,r}function Xt(r,e,t,n,i,s,o){return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r[4]=s,r[5]=o,r}function pn(r,e){const t=e[0],n=e[1];return e[0]=r[0]*t+r[2]*n+r[4],e[1]=r[1]*t+r[3]*n+r[5],e}function vs(r,e){const t=Math.cos(e),n=Math.sin(e);return Pn(r,Xt(Sn,t,n,-n,t,0,0))}function ai(r,e,t){return Pn(r,Xt(Sn,e,0,0,t,0,0))}function xs(r,e,t){return Pn(r,Xt(Sn,1,0,0,1,e,t))}function zt(r,e,t,n,i,s,o,a){const l=Math.sin(s),h=Math.cos(s);return r[0]=n*h,r[1]=i*l,r[2]=-n*l,r[3]=i*h,r[4]=o*n*h-a*n*l+e,r[5]=o*i*l+a*i*h+t,r}function Cs(r,e){const t=ws(e);X(t!==0,"Transformation matrix cannot be inverted");const n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5];return r[0]=o/t,r[1]=-i/t,r[2]=-s/t,r[3]=n/t,r[4]=(s*l-o*a)/t,r[5]=-(n*l-i*a)/t,r}function ws(r){return r[0]*r[3]-r[1]*r[2]}function Is(r,e,t,n,i,s){s=s||[];let o=0;for(let a=e;a<t;a+=n){const l=r[a],h=r[a+1];s[o++]=i[0]*l+i[2]*h+i[4],s[o++]=i[1]*l+i[3]*h+i[5]}return s&&s.length!=o&&(s.length=o),s}function bs(r,e,t,n,i,s,o){o=o||[];const a=Math.cos(i),l=Math.sin(i),h=s[0],c=s[1];let u=0;for(let d=e;d<t;d+=n){const g=r[d]-h,f=r[d+1]-c;o[u++]=h+g*a-f*l,o[u++]=c+g*l+f*a;for(let _=d+2;_<d+n;++_)o[u++]=r[_]}return o&&o.length!=u&&(o.length=u),o}function Ls(r,e,t,n,i,s,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=e;u<t;u+=n){const d=r[u]-l,g=r[u+1]-h;a[c++]=l+i*d,a[c++]=h+s*g;for(let f=u+2;f<u+n;++f)a[c++]=r[f]}return a&&a.length!=c&&(a.length=c),a}function As(r,e,t,n,i,s,o){o=o||[];let a=0;for(let l=e;l<t;l+=n){o[a++]=r[l]+i,o[a++]=r[l+1]+s;for(let h=l+2;h<l+n;++h)o[a++]=r[h]}return o&&o.length!=a&&(o.length=a),o}const li=De();class Ss extends pe{constructor(){super(),this.extent_=Mt(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=ds((e,t,n)=>{if(!n)return this.getSimplifiedGeometry(t);const i=this.clone();return i.applyTransform(n),i.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return k()}closestPointXY(e,t,n,i){return k()}containsXY(e,t){const n=this.getClosestPoint([e,t]);return n[0]===e&&n[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return k()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&Ui(t),this.extentRevision_=this.getRevision()}return Fr(this.extent_,e)}rotate(e,t){k()}scale(e,t,n){k()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return k()}getType(){return k()}applyTransform(e){k()}intersectsExtent(e){return k()}translate(e,t){k()}transform(e,t){const n=ht(e),i=n.getUnits()=="tile-pixels"?function(s,o,a){const l=n.getExtent(),h=n.getWorldExtent(),c=_e(h)/_e(l);return zt(li,h[0],h[3],c,-c,0,0,0),Is(s,0,s.length,a,li,o),dn(n,t)(s,o,a)}:dn(n,t);return this.applyTransform(i),this}}class Dn extends Ss{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return Ur(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return k()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=hi(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){k()}setLayout(e,t,n){let i;if(e)i=hi(e);else{for(let s=0;s<n;++s){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}i=t.length,e=Ps(i)}this.layout=e,this.stride=i}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const n=this.getFlatCoordinates();if(n){const i=this.getStride();bs(n,0,n.length,i,e,t,n),this.changed()}}scale(e,t,n){t===void 0&&(t=e),n||(n=it(this.getExtent()));const i=this.getFlatCoordinates();if(i){const s=this.getStride();Ls(i,0,i.length,s,e,t,n,i),this.changed()}}translate(e,t){const n=this.getFlatCoordinates();if(n){const i=this.getStride();As(n,0,n.length,i,e,t,n),this.changed()}}}function Ps(r){let e;return r==2?e="XY":r==3?e="XYZ":r==4&&(e="XYZM"),e}function hi(r){let e;return r=="XY"?e=2:r=="XYZ"||r=="XYM"?e=3:r=="XYZM"&&(e=4),e}function ci(r,e,t,n,i,s,o){const a=r[e],l=r[e+1],h=r[t]-a,c=r[t+1]-l;let u;if(h===0&&c===0)u=e;else{const d=((i-a)*h+(s-l)*c)/(h*h+c*c);if(d>1)u=t;else if(d>0){for(let g=0;g<n;++g)o[g]=Gr(r[e+g],r[t+g],d);o.length=n;return}else u=e}for(let d=0;d<n;++d)o[d]=r[u+d];o.length=n}function $i(r,e,t,n,i){let s=r[e],o=r[e+1];for(e+=n;e<t;e+=n){const a=r[e],l=r[e+1],h=nt(s,o,a,l);h>i&&(i=h),s=a,o=l}return i}function Ds(r,e,t,n,i){for(let s=0,o=t.length;s<o;++s){const a=t[s];i=$i(r,e,a,n,i),e=a}return i}function Yi(r,e,t,n,i,s,o,a,l,h,c){if(e==t)return h;let u,d;if(i===0){if(d=nt(o,a,r[e],r[e+1]),d<h){for(u=0;u<n;++u)l[u]=r[e+u];return l.length=n,d}return h}c=c||[NaN,NaN];let g=e+n;for(;g<t;)if(ci(r,g-n,g,n,o,a,c),d=nt(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n,g+=n}else g+=n*Math.max((Math.sqrt(d)-Math.sqrt(h))/i|0,1);if(s&&(ci(r,t-n,e,n,o,a,c),d=nt(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function Os(r,e,t,n,i,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const g=t[u];h=Yi(r,e,g,n,i,s,o,a,l,h,c),e=g}return h}function Ms(r,e,t,n){for(let i=0,s=t.length;i<s;++i)r[e++]=t[i];return e}function Bi(r,e,t,n){for(let i=0,s=t.length;i<s;++i){const o=t[i];for(let a=0;a<n;++a)r[e++]=o[a]}return e}function Ns(r,e,t,n,i){i=i||[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=Bi(r,e,t[o],n);i[s++]=l,e=l}return i.length=s,i}function Fs(r,e,t,n,i,s,o){const a=(t-e)/n;if(a<3){for(;e<t;e+=n)s[o++]=r[e],s[o++]=r[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,t-n];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let g=0;const f=r[d],_=r[d+1],p=r[u],E=r[u+1];for(let m=d+n;m<u;m+=n){const v=r[m],y=r[m+1],R=Xr(v,y,f,_,p,E);R>g&&(c=m,g=R)}g>i&&(l[(c-e)/n]=1,d+n<c&&h.push(d,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(s[o++]=r[e+u*n],s[o++]=r[e+u*n+1]);return o}function Ne(r,e){return e*Math.round(r/e)}function Us(r,e,t,n,i,s,o){if(e==t)return o;let a=Ne(r[e],i),l=Ne(r[e+1],i);e+=n,s[o++]=a,s[o++]=l;let h,c;do if(h=Ne(r[e],i),c=Ne(r[e+1],i),e+=n,e==t)return s[o++]=h,s[o++]=c,o;while(h==a&&c==l);for(;e<t;){const u=Ne(r[e],i),d=Ne(r[e+1],i);if(e+=n,u==h&&d==c)continue;const g=h-a,f=c-l,_=u-a,p=d-l;if(g*p==f*_&&(g<0&&_<g||g==_||g>0&&_>g)&&(f<0&&p<f||f==p||f>0&&p>f)){h=u,c=d;continue}s[o++]=h,s[o++]=c,a=h,l=c,h=u,c=d}return s[o++]=h,s[o++]=c,o}function Gs(r,e,t,n,i,s,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=Us(r,e,c,n,i,s,o),a.push(o),e=c}return o}function Vi(r,e,t,n,i){i=i!==void 0?i:[];let s=0;for(let o=e;o<t;o+=n)i[s++]=r.slice(o,o+n);return i.length=s,i}function Xs(r,e,t,n,i){i=i!==void 0?i:[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];i[s++]=Vi(r,e,l,n,i[s]),e=l}return i.length=s,i}function Wi(r,e,t,n){let i=0,s=r[t-n],o=r[t-n+1];for(;e<t;e+=n){const a=r[e],l=r[e+1];i+=o*a-s*l,s=a,o=l}return i/2}function zs(r,e,t,n){let i=0;for(let s=0,o=t.length;s<o;++s){const a=t[s];i+=Wi(r,e,a,n),e=a}return i}class ot extends Dn{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new ot(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,n,i){return i<Gi(this.getExtent(),e,t)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt($i(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Yi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,n,i))}getArea(){return Wi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Vi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=Fs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new ot(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Bi(this.flatCoordinates,0,e,this.stride),this.changed()}}class On extends Dn{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new On(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,i){const s=this.flatCoordinates,o=nt(e,t,s[0],s[1]);if(o<i){const a=this.stride;for(let l=0;l<a;++l)n[l]=s[l];return n.length=a,o}return i}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return zr(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return kr(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ms(this.flatCoordinates,0,e,this.stride),this.changed()}}function ks(r,e,t,n,i){return!Xi(i,function(o){return!Se(r,e,t,n,o[0],o[1])})}function Se(r,e,t,n,i,s){let o=0,a=r[t-n],l=r[t-n+1];for(;e<t;e+=n){const h=r[e],c=r[e+1];l<=s?c>s&&(h-a)*(s-l)-(i-a)*(c-l)>0&&o++:c<=s&&(h-a)*(s-l)-(i-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function Hi(r,e,t,n,i,s){if(t.length===0||!Se(r,e,t[0],n,i,s))return!1;for(let o=1,a=t.length;o<a;++o)if(Se(r,t[o-1],t[o],n,i,s))return!1;return!0}function js(r,e,t,n,i,s,o){let a,l,h,c,u,d,g;const f=i[s+1],_=[];for(let m=0,v=t.length;m<v;++m){const y=t[m];for(c=r[y-n],d=r[y-n+1],a=e;a<y;a+=n)u=r[a],g=r[a+1],(f<=d&&g<=f||d<=f&&f<=g)&&(h=(f-d)/(g-d)*(u-c)+c,_.push(h)),c=u,d=g}let p=NaN,E=-1/0;for(_.sort(bn),c=_[0],a=1,l=_.length;a<l;++a){u=_[a];const m=Math.abs(u-c);m>E&&(h=(c+u)/2,Hi(r,e,t,n,h,f)&&(p=h,E=m)),c=u}return isNaN(p)&&(p=i[s]),o?(o.push(p,f,E),o):[p,f,E]}function Zs(r,e,t,n,i){let s;for(e+=n;e<t;e+=n)if(s=i(r.slice(e-n,e),r.slice(e,e+n)),s)return s;return!1}function qi(r,e,t,n,i){const s=jr(Mt(),r,e,t,n);return xn(i,s)?Zr(i,s)||s[0]>=i[0]&&s[2]<=i[2]||s[1]>=i[1]&&s[3]<=i[3]?!0:Zs(r,e,t,n,function(o,a){return Kr(i,o,a)}):!1}function Qi(r,e,t,n,i){return!!(qi(r,e,t,n,i)||Se(r,e,t,n,i[0],i[1])||Se(r,e,t,n,i[0],i[3])||Se(r,e,t,n,i[2],i[1])||Se(r,e,t,n,i[2],i[3]))}function Ks(r,e,t,n,i){if(!Qi(r,e,t[0],n,i))return!1;if(t.length===1)return!0;for(let s=1,o=t.length;s<o;++s)if(ks(r,t[s-1],t[s],n,i)&&!qi(r,t[s-1],t[s],n,i))return!1;return!0}function $s(r,e,t,n){for(;e<t-n;){for(let i=0;i<n;++i){const s=r[e+i];r[e+i]=r[t-n+i],r[t-n+i]=s}e+=n,t-=n}}function Ji(r,e,t,n){let i=0,s=r[t-n],o=r[t-n+1];for(;e<t;e+=n){const a=r[e],l=r[e+1];i+=(a-s)*(l+o),s=a,o=l}return i===0?void 0:i>0}function Ys(r,e,t,n,i){i=i!==void 0?i:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=Ji(r,e,a,n);if(s===0){if(i&&l||!i&&!l)return!1}else if(i&&!l||!i&&l)return!1;e=a}return!0}function ui(r,e,t,n,i){i=i!==void 0?i:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=Ji(r,e,a,n);(s===0?i&&l||!i&&!l:i&&!l||!i&&l)&&$s(r,e,a,n),e=a}return e}class at extends Dn{constructor(e,t,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&n?(this.setFlatCoordinates(t,e),this.ends_=n):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?cs(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new at(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,i){return i<Gi(this.getExtent(),e,t)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ds(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Os(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,n,i))}containsXY(e,t){return Hi(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return zs(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),ui(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,Xs(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=it(this.getExtent());this.flatInteriorPoint_=js(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new On(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new ot(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,n=this.ends_,i=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new ot(t.slice(s,l),e);i.push(h),s=l}return i}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;Ys(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=ui(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=Gs(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,n),new at(t,"XY",n)}getType(){return"Polygon"}intersectsExtent(e){return Ks(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Ns(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function di(r){if(Nt(r))throw new Error("Cannot create polygon from empty extent");const e=r[0],t=r[1],n=r[2],i=r[3],s=[e,t,e,i,n,i,n,t,e,t];return new at(s,"XY",[s.length])}const ne={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Fe={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function gi(r){return r[0]>0&&r[1]>0}function Bs(r,e,t){return t===void 0&&(t=[0,0]),t[0]=r[0]*e+.5|0,t[1]=r[1]*e+.5|0,t}function he(r,e){return Array.isArray(r)?r:(e===void 0?e=[r,r]:(e[0]=r,e[1]=r),e)}const At={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var q={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};q.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};q.max=q.whitepoint[2].D65;q.rgb=function(r,e){e=e||q.whitepoint[2].E;var t=r[0]/e[0],n=r[1]/e[1],i=r[2]/e[2],s,o,a;return s=t*3.240969941904521+n*-1.537383177570093+i*-.498610760293,o=t*-.96924363628087+n*1.87596750150772+i*.041555057407175,a=t*.055630079696993+n*-.20397695888897+i*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[s*255,o*255,a*255]};At.xyz=function(r,e){var t=r[0]/255,n=r[1]/255,i=r[2]/255;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92;var s=t*.41239079926595+n*.35758433938387+i*.18048078840183,o=t*.21263900587151+n*.71516867876775+i*.072192315360733,a=t*.019330818715591+n*.11919477979462+i*.95053215224966;return e=e||q.whitepoint[2].E,[s*e[0],o*e[1],a*e[2]]};const er={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(r,e,t){var n,i,s,o,a,l,h,c,u,d,g,f,_;if(s=r[0],o=r[1],a=r[2],s===0)return[0,0,0];var p=.0011070564598794539;return e=e||"D65",t=t||2,u=q.whitepoint[t][e][0],d=q.whitepoint[t][e][1],g=q.whitepoint[t][e][2],f=4*u/(u+15*d+3*g),_=9*d/(u+15*d+3*g),n=o/(13*s)+f||0,i=a/(13*s)+_||0,h=s>8?d*Math.pow((s+16)/116,3):d*s*p,l=h*9*n/(4*i)||0,c=h*(12-3*n-20*i)/(4*i)||0,[l,h,c]}};q.luv=function(r,e,t){var n,i,s,o,a,l,h,c,u,d,g,f,_,p=.008856451679035631,E=903.2962962962961;e=e||"D65",t=t||2,u=q.whitepoint[t][e][0],d=q.whitepoint[t][e][1],g=q.whitepoint[t][e][2],f=4*u/(u+15*d+3*g),_=9*d/(u+15*d+3*g),l=r[0],h=r[1],c=r[2],n=4*l/(l+15*h+3*c)||0,i=9*h/(l+15*h+3*c)||0;var m=h/d;return s=m<=p?E*m:116*Math.pow(m,1/3)-16,o=13*s*(n-f),a=13*s*(i-_),[s,o,a]};er.lchuv=function(r){var e=r[0],t=r[1],n=r[2],i=Math.sqrt(t*t+n*n),s=Math.atan2(n,t),o=s*360/2/Math.PI;return o<0&&(o+=360),[e,i,o]};q.lchuv=function(r){return er.lchuv(q.luv(r))};var Vs={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const fi=$r(Vs);var _i={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Ws(r){var c,u;var e,t=[],n=1,i;if(typeof r=="number")return{space:"rgb",values:[r>>>16,(r&65280)>>>8,r&255],alpha:1};if(typeof r=="number")return{space:"rgb",values:[r>>>16,(r&65280)>>>8,r&255],alpha:1};if(r=String(r).toLowerCase(),fi[r])t=fi[r].slice(),i="rgb";else if(r==="transparent")n=0,i="rgb",t=[0,0,0];else if(r[0]==="#"){var s=r.slice(1),o=s.length,a=o<=4;n=1,a?(t=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],o===4&&(n=parseInt(s[3]+s[3],16)/255)):(t=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],o===8&&(n=parseInt(s[6]+s[7],16)/255)),t[0]||(t[0]=0),t[1]||(t[1]=0),t[2]||(t[2]=0),i="rgb"}else if(e=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(r)){var l=e[1];i=l.replace(/a$/,"");var h=i==="cmyk"?4:i==="gray"?1:3;t=e[2].trim().split(/\s*[,\/]\s*|\s+/),i==="color"&&(i=t.shift()),t=t.map(function(d,g){if(d[d.length-1]==="%")return d=parseFloat(d)/100,g===3?d:i==="rgb"?d*255:i[0]==="h"||i[0]==="l"&&!g?d*100:i==="lab"?d*125:i==="lch"?g<2?d*150:d*360:i[0]==="o"&&!g?d:i==="oklab"?d*.4:i==="oklch"?g<2?d*.4:d*360:d;if(i[g]==="h"||g===2&&i[i.length-1]==="h"){if(_i[d]!==void 0)return _i[d];if(d.endsWith("deg"))return parseFloat(d);if(d.endsWith("turn"))return parseFloat(d)*360;if(d.endsWith("grad"))return parseFloat(d)*360/400;if(d.endsWith("rad"))return parseFloat(d)*180/Math.PI}return d==="none"?0:parseFloat(d)}),n=t.length>h?t.pop():1}else/[0-9](?:\s|\/|,)/.test(r)&&(t=r.match(/([0-9]+)/g).map(function(d){return parseFloat(d)}),i=((u=(c=r.match(/([a-z])/ig))==null?void 0:c.join(""))==null?void 0:u.toLowerCase())||"rgb");return{space:i,values:t,alpha:n}}const qt={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(r){var e=r[0]/360,t=r[1]/100,n=r[2]/100,i,s,o,a,l,h=0;if(t===0)return l=n*255,[l,l,l];for(s=n<.5?n*(1+t):n+t-n*t,i=2*n-s,a=[0,0,0];h<3;)o=e+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?i+(s-i)*6*o:2*o<1?s:3*o<2?i+(s-i)*(2/3-o)*6:i,a[h++]=l*255;return a}};At.hsl=function(r){var e=r[0]/255,t=r[1]/255,n=r[2]/255,i=Math.min(e,t,n),s=Math.max(e,t,n),o=s-i,a,l,h;return s===i?a=0:e===s?a=(t-n)/o:t===s?a=2+(n-e)/o:n===s&&(a=4+(e-t)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(i+s)/2,s===i?l=0:h<=.5?l=o/(s+i):l=o/(2-s-i),[a,l*100,h*100]};function Hs(r){Array.isArray(r)&&r.raw&&(r=String.raw(...arguments)),r instanceof Number&&(r=+r);var e,t=Ws(r);if(!t.space)return[];const n=t.space[0]==="h"?qt.min:At.min,i=t.space[0]==="h"?qt.max:At.max;return e=Array(3),e[0]=Math.min(Math.max(t.values[0],n[0]),i[0]),e[1]=Math.min(Math.max(t.values[1],n[1]),i[1]),e[2]=Math.min(Math.max(t.values[2],n[2]),i[2]),t.space[0]==="h"&&(e=qt.rgb(e)),e.push(Math.min(Math.max(t.alpha,0),1)),e}function qs(r){return typeof r=="string"?r:eo(r)}const Qs=1024,Je={};let Qt=0;function tr(r){if(Je.hasOwnProperty(r))return Je[r];if(Qt>=Qs){let t=0;for(const n in Je)t++&3||(delete Je[n],--Qt)}const e=Hs(r);if(e.length!==4)throw new Error('Failed to parse "'+r+'" as color');for(const t of e)if(isNaN(t))throw new Error('Failed to parse "'+r+'" as color');return Js(e),Je[r]=e,++Qt,e}function nr(r){return Array.isArray(r)?r:tr(r)}function Js(r){return r[0]=$(r[0]+.5|0,0,255),r[1]=$(r[1]+.5|0,0,255),r[2]=$(r[2]+.5|0,0,255),r[3]=$(r[3],0,1),r}function eo(r){let e=r[0];e!=(e|0)&&(e=e+.5|0);let t=r[1];t!=(t|0)&&(t=t+.5|0);let n=r[2];n!=(n|0)&&(n=n+.5|0);const i=r[3]===void 0?1:Math.round(r[3]*100)/100;return"rgba("+e+","+t+","+n+","+i+")"}function to(r){try{return tr(r),!0}catch{return!1}}function Oe(r,e,t,n){let i;return t&&t.length?i=t.shift():ys?i=new OffscreenCanvas(r||300,e||300):i=document.createElement("canvas"),r&&(i.width=r),e&&(i.height=e),i.getContext("2d",n)}function lt(r){const e=r.canvas;e.width=1,e.height=1,r.clearRect(0,0,1,1)}function mi(r,e){const t=e.parentNode;t&&t.replaceChild(r,e)}function En(r){return r&&r.parentNode?r.parentNode.removeChild(r):null}function no(r){for(;r.lastChild;)r.removeChild(r.lastChild)}function io(r,e){const t=r.childNodes;for(let n=0;;++n){const i=t[n],s=e[n];if(!i&&!s)break;if(i!==s){if(!i){r.appendChild(s);continue}if(!s){r.removeChild(i),--n;continue}r.insertBefore(s,i)}}}const Et="ol-hidden",kt="ol-unselectable",Mn="ol-control",pi="ol-collapsed",ro=new pe,N={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class ir extends pe{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[N.OPACITY]=e.opacity!==void 0?e.opacity:1,X(typeof t[N.OPACITY]=="number","Layer opacity must be a number"),t[N.VISIBLE]=e.visible!==void 0?e.visible:!0,t[N.Z_INDEX]=e.zIndex,t[N.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[N.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[N.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[N.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},n=this.getZIndex();return t.opacity=$(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=n===void 0&&!t.managed?1/0:n,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return k()}getLayerStatesArray(e){return k()}getExtent(){return this.get(N.EXTENT)}getMaxResolution(){return this.get(N.MAX_RESOLUTION)}getMinResolution(){return this.get(N.MIN_RESOLUTION)}getMinZoom(){return this.get(N.MIN_ZOOM)}getMaxZoom(){return this.get(N.MAX_ZOOM)}getOpacity(){return this.get(N.OPACITY)}getSourceState(){return k()}getVisible(){return this.get(N.VISIBLE)}getZIndex(){return this.get(N.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(N.EXTENT,e)}setMaxResolution(e){this.set(N.MAX_RESOLUTION,e)}setMinResolution(e){this.set(N.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(N.MAX_ZOOM,e)}setMinZoom(e){this.set(N.MIN_ZOOM,e)}setOpacity(e){X(typeof e=="number","Layer opacity must be a number"),this.set(N.OPACITY,e)}setVisible(e){this.set(N.VISIBLE,e)}setZIndex(e){this.set(N.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const ee={ANIMATING:0,INTERACTING:1},se={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},so=42,Nn=256;function Ei(r,e,t){return function(n,i,s,o,a){if(!n)return;if(!i&&!e)return n;const l=e?0:s[0]*i,h=e?0:s[1]*i,c=a?a[0]:0,u=a?a[1]:0;let d=r[0]+l/2+c,g=r[2]-l/2+c,f=r[1]+h/2+u,_=r[3]-h/2+u;d>g&&(d=(g+d)/2,g=d),f>_&&(f=(_+f)/2,_=f);let p=$(n[0],d,g),E=$(n[1],f,_);if(o&&t&&i){const m=30*i;p+=-m*Math.log(1+Math.max(0,d-n[0])/m)+m*Math.log(1+Math.max(0,n[0]-g)/m),E+=-m*Math.log(1+Math.max(0,f-n[1])/m)+m*Math.log(1+Math.max(0,n[1]-_)/m)}return[p,E]}}function oo(r){return r}function Fn(r,e,t,n){const i=H(e)/t[0],s=_e(e)/t[1];return n?Math.min(r,Math.max(i,s)):Math.min(r,Math.min(i,s))}function Un(r,e,t){let n=Math.min(r,e);const i=50;return n*=Math.log(1+i*Math.max(0,r/e-1))/i+1,t&&(n=Math.max(n,t),n/=Math.log(1+i*Math.max(0,t/r-1))/i+1),$(n,t/2,e*2)}function ao(r,e,t,n){return e=e!==void 0?e:!0,function(i,s,o,a){if(i!==void 0){const l=r[0],h=r[r.length-1],c=t?Fn(l,t,o,n):l;if(a)return e?Un(i,c,h):$(i,h,c);const u=Math.min(c,i),d=Math.floor(Ln(r,u,s));return r[d]>c&&d<r.length-1?r[d+1]:r[d]}}}function lo(r,e,t,n,i,s){return n=n!==void 0?n:!0,t=t!==void 0?t:0,function(o,a,l,h){if(o!==void 0){const c=i?Fn(e,i,l,s):e;if(h)return n?Un(o,c,t):$(o,t,c);const u=1e-9,d=Math.ceil(Math.log(e/c)/Math.log(r)-u),g=-a*(.5-u)+.5,f=Math.min(c,o),_=Math.floor(Math.log(e/f)/Math.log(r)+g),p=Math.max(d,_),E=e/Math.pow(r,p);return $(E,t,c)}}}function yi(r,e,t,n,i){return t=t!==void 0?t:!0,function(s,o,a,l){if(s!==void 0){const h=n?Fn(r,n,a,i):r;return!t||!l?$(s,e,h):Un(s,h,e)}}}function Gn(r){if(r!==void 0)return 0}function Ti(r){if(r!==void 0)return r}function ho(r){const e=2*Math.PI/r;return function(t,n){if(n)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function co(r){const e=r===void 0?Yr(5):r;return function(t,n){return n||t===void 0?t:Math.abs(t)<=e?0:t}}function rr(r){return Math.pow(r,3)}function Be(r){return 1-rr(1-r)}function uo(r){return 3*r*r-2*r*r*r}function go(r){return r}const Jt=0;class le extends pe{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Cn(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&Br(),e.center&&(e.center=ge(e.center,this.projection_)),e.extent&&(e.extent=Ke(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in se)delete t[a];this.setProperties(t,!0);const n=_o(e);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=n.minZoom;const i=fo(e),s=n.constraint,o=mo(e);this.constraints_={center:i,resolution:s,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const n=this.getCenterInternal();if(n){const i=e||[0,0,0,0];t=t||[0,0,0,0];const s=this.getResolution(),o=s/2*(i[3]-t[3]+t[1]-i[1]),a=s/2*(i[0]-t[0]+t[2]-i[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let n=0;n<t.length;++n){let i=arguments[n];i.center&&(i=Object.assign({},i),i.center=ge(i.center,this.getProjection())),i.anchor&&(i=Object.assign({},i),i.anchor=ge(i.anchor,this.getProjection())),t[n]=i}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,n;t>1&&typeof arguments[t-1]=="function"&&(n=arguments[t-1],--t);let i=0;for(;i<t&&!this.isDef();++i){const c=arguments[i];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(i===t){n&&yt(n,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;i<t;++i){const c=arguments[i],u={start:s,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||uo,callback:n};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=$e(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}po(u)?u.complete=!0:s+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(ee.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ee.ANIMATING]>0}getInteracting(){return this.hints_[ee.INTERACTING]>0}cancelAnimations(){this.setHint(ee.ANIMATING,-this.hints_[ee.ANIMATING]);let e;for(let t=0,n=this.animations_.length;t<n;++t){const i=this.animations_[t];if(i[0].callback&&yt(i[0].callback,!1),!e)for(let s=0,o=i.length;s<o;++s){const a=i[s];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let n=this.animations_.length-1;n>=0;--n){const i=this.animations_[n];let s=!0;for(let o=0,a=i.length;o<a;++o){const l=i[o];if(l.complete)continue;const h=e-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):s=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],g=l.sourceCenter[1],f=l.targetCenter[0],_=l.targetCenter[1];this.nextCenter_=l.targetCenter;const p=d+u*(f-d),E=g+u*(_-g);this.targetCenter_=[p,E]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const g=this.getViewportSize_(this.getRotation()),f=this.constraints_.resolution(d,0,g,!0);this.targetCenter_=this.calculateCenterZoom(f,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?$e(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const g=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(g,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(s){this.animations_[n]=null,this.setHint(ee.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=i[0].callback;o&&yt(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let n;const i=this.getCenterInternal();return i!==void 0&&(n=[i[0]-t[0],i[1]-t[1]],wn(n,e-this.getRotation()),Vr(n,t)),n}calculateCenterZoom(e,t){let n;const i=this.getCenterInternal(),s=this.getResolution();if(i!==void 0&&s!==void 0){const o=t[0]-e*(t[0]-i[0])/s,a=t[1]-e*(t[1]-i[1])/s;n=[o,a]}return n}getViewportSize_(e){const t=this.viewportSize_;if(e){const n=t[0],i=t[1];return[Math.abs(n*Math.cos(e))+Math.abs(i*Math.sin(e)),Math.abs(n*Math.sin(e))+Math.abs(i*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&gn(e,this.getProjection())}getCenterInternal(){return this.get(se.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return Wr(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();X(t,"The view center is not defined");const n=this.getResolution();X(n!==void 0,"The view resolution is not defined");const i=this.getRotation();return X(i!==void 0,"The view rotation is not defined"),fn(t,n,i,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(se.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(Ke(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const n=H(e)/t[0],i=_e(e)/t[1];return Math.max(n,i)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(t/n)/Math.log(e);return function(s){return t/Math.pow(e,s*i)}}getRotation(){return this.get(se.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),n=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,s=Math.log(n/i)/t;return function(o){return Math.log(n/o)/t/s}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const n=this.padding_;return n&&(t=[t[0]-n[1]-n[3],t[1]-n[0]-n[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),n=this.getRotation();let i=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();i=en(i,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],t,n)}return{center:i.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,n,i;if(this.resolutions_){const s=Ln(this.resolutions_,e,1);t=s,n=this.resolutions_[s],s==this.resolutions_.length-1?i=2:i=n/this.resolutions_[s+1]}else n=this.maxResolution_,i=this.zoomFactor_;return t+Math.log(n/e)/Math.log(i)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=$(Math.floor(e),0,this.resolutions_.length-2),n=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(n,$(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let n;if(X(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){X(!Nt(e),"Cannot fit empty extent provided as `geometry`");const i=Ke(e,this.getProjection());n=di(i)}else if(e.getType()==="Circle"){const i=Ke(e.getExtent(),this.getProjection());n=di(i),n.rotate(this.getRotation(),it(i))}else n=e;this.fitInternal(n,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),n=Math.cos(t),i=Math.sin(-t),s=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=s.length;u<d;u+=o){const g=s[u]*n-s[u+1]*i,f=s[u]*i+s[u+1]*n;a=Math.min(a,g),l=Math.min(l,f),h=Math.max(h,g),c=Math.max(c,f)}return[a,l,h,c]}fitInternal(e,t){t=t||{};let n=t.size;n||(n=this.getViewportSizeMinusPadding_());const i=t.padding!==void 0?t.padding:[0,0,0,0],s=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[n[0]-i[1]-i[3],n[1]-i[0]-i[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=it(a);d[0]+=(i[1]-i[3])/2*l,d[1]+=(i[0]-i[2])/2*l;const g=d[0]*u-d[1]*c,f=d[1]*u+d[0]*c,_=this.getConstrainedCenter([g,f],l),p=t.callback?t.callback:bt;t.duration!==void 0?this.animateInternal({resolution:l,center:_,duration:t.duration,easing:t.easing},p):(this.targetResolution_=l,this.targetCenter_=_,this.applyTargetState_(!1,!0),yt(p,!0))}centerOn(e,t,n){this.centerOnInternal(ge(e,this.getProjection()),t,n)}centerOnInternal(e,t,n){this.setCenterInternal(en(e,t,n,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,n,i){let s;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-n),l=en(e,i,[a[0]/2+o[3],a[1]/2+o[0]],t,n);s=[e[0]-l[0],e[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=gn(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&ge(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const n=this.getAnimating()||this.getInteracting(),i=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*e,0,i,n);t&&(this.targetCenter_=this.calculateCenterZoom(s,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=ge(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const n=this.getAnimating()||this.getInteracting(),i=this.constraints_.rotation(this.targetRotation_+e,n);t&&(this.targetCenter_=this.calculateCenterRotate(i,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&ge(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const n=this.getAnimating()||this.getInteracting()||t,i=this.constraints_.rotation(this.targetRotation_,n),s=this.getViewportSize_(i),o=this.constraints_.resolution(this.targetResolution_,0,s,n),a=this.constraints_.center(this.targetCenter_,o,s,n,this.calculateCenterShift(this.targetCenter_,o,i,s));this.get(se.ROTATION)!==i&&this.set(se.ROTATION,i),this.get(se.RESOLUTION)!==o&&(this.set(se.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(se.CENTER)||!_n(this.get(se.CENTER),a))&&this.set(se.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,n){e=e!==void 0?e:200;const i=t||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,i,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}n=n||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!_n(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:e,easing:Be,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ee.INTERACTING,1)}endInteraction(e,t,n){n=n&&ge(n,this.getProjection()),this.endInteractionInternal(e,t,n)}endInteractionInternal(e,t,n){this.getInteracting()&&(this.setHint(ee.INTERACTING,-1),this.resolveConstraints(e,t,n))}getConstrainedCenter(e,t){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),n)}getConstrainedZoom(e,t){const n=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(n,t))}getConstrainedResolution(e,t){t=t||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,n)}}function yt(r,e){setTimeout(function(){r(e)},0)}function fo(r){if(r.extent!==void 0){const t=r.smoothExtentConstraint!==void 0?r.smoothExtentConstraint:!0;return Ei(r.extent,r.constrainOnlyCenter,t)}const e=Cn(r.projection,"EPSG:3857");if(r.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,Ei(t,!1,!1)}return oo}function _o(r){let e,t,n,o=r.minZoom!==void 0?r.minZoom:Jt,a=r.maxZoom!==void 0?r.maxZoom:28;const l=r.zoomFactor!==void 0?r.zoomFactor:2,h=r.multiWorld!==void 0?r.multiWorld:!1,c=r.smoothResolutionConstraint!==void 0?r.smoothResolutionConstraint:!0,u=r.showFullExtent!==void 0?r.showFullExtent:!1,d=Cn(r.projection,"EPSG:3857"),g=d.getExtent();let f=r.constrainOnlyCenter,_=r.extent;if(!h&&!_&&d.isGlobal()&&(f=!1,_=g),r.resolutions!==void 0){const p=r.resolutions;t=p[o],n=p[a]!==void 0?p[a]:p[p.length-1],r.constrainResolution?e=ao(p,c,!f&&_,u):e=yi(t,n,c,!f&&_,u)}else{const E=(g?Math.max(H(g),_e(g)):360*zi.degrees/d.getMetersPerUnit())/Nn/Math.pow(2,Jt),m=E/Math.pow(2,28-Jt);t=r.maxResolution,t!==void 0?o=0:t=E/Math.pow(l,o),n=r.minResolution,n===void 0&&(r.maxZoom!==void 0?r.maxResolution!==void 0?n=t/Math.pow(l,a):n=E/Math.pow(l,a):n=m),a=o+Math.floor(Math.log(t/n)/Math.log(l)),n=t/Math.pow(l,a-o),r.constrainResolution?e=lo(l,t,n,c,!f&&_,u):e=yi(t,n,c,!f&&_,u)}return{constraint:e,maxResolution:t,minResolution:n,minZoom:o,zoomFactor:l}}function mo(r){if(r.enableRotation!==void 0?r.enableRotation:!0){const t=r.constrainRotation;return t===void 0||t===!0?co():t===!1?Ti:typeof t=="number"?ho(t):Ti}return Gn}function po(r){return!(r.sourceCenter&&r.targetCenter&&!_n(r.sourceCenter,r.targetCenter)||r.sourceResolution!==r.targetResolution||r.sourceRotation!==r.targetRotation)}function en(r,e,t,n,i){const s=Math.cos(-i);let o=Math.sin(-i),a=r[0]*s-r[1]*o,l=r[1]*s+r[0]*o;a+=(e[0]/2-t[0])*n,l+=(t[1]-e[1]/2)*n,o=-o;const h=a*s-l*o,c=l*s+a*o;return[h,c]}class Eo extends ir{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(N.SOURCE,this.handleSourcePropertyChange_);const n=e.source?e.source:null;this.setSource(n)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(N.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(j(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=F(e,S.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const n=this.getMapInternal();!e&&n&&(e=n.getView()),e instanceof le?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&n&&(t.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let i;t.layerStatesArray?i=t.layerStatesArray.find(o=>o.layer===this):i=this.getLayerState();const s=this.getExtent();return Xn(i,t.viewState)&&(!s||xn(s,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t;const n=this.getSource();if(n&&(t=n.getAttributions()),!t)return[];const i=e instanceof le?e.getViewStateAndExtent():e;let s=t(i);return Array.isArray(s)||(s=[s]),s}render(e,t){const n=this.getRenderer();return n.prepareFrame(e)?(this.rendered=!0,n.renderFrame(e,t)):null}unrender(){this.rendered=!1}setMapInternal(e){e||this.unrender(),this.set(N.MAP,e)}getMapInternal(){return this.get(N.MAP)}setMap(e){this.mapPrecomposeKey_&&(j(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(j(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=F(e,ne.PRECOMPOSE,function(t){const i=t.frameState.layerStatesArray,s=this.getLayerState(!1);X(!i.some(function(o){return o.layer===s.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),i.push(s)},this),this.mapRenderKey_=F(this,S.CHANGE,e.render,e),this.changed())}setSource(e){this.set(N.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function Xn(r,e){if(!r.visible)return!1;const t=e.resolution;if(t<r.minResolution||t>=r.maxResolution)return!1;const n=e.zoom;return n>r.minZoom&&n<=r.maxZoom}const zn=Eo;function yo(r,e,t){const n=r;let i=!0,s=!1,o=!1;const a=[Lt(n,S.LOAD,function(){o=!0,s||e()})];return n.src&&Ts?(s=!0,n.decode().then(function(){i&&e()}).catch(function(l){i&&(o?e():t())})):a.push(Lt(n,S.ERROR,t)),function(){i=!1,a.forEach(j)}}class To{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const n=this.cache_[t];!(e++&3)&&!n.hasListener()&&(delete this.cache_[t],--this.cacheSize_)}}}get(e,t,n){const i=Ri(e,t,n);return i in this.cache_?this.cache_[i]:null}set(e,t,n,i){const s=Ri(e,t,n);this.cache_[s]=i,++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function Ri(r,e,t){const n=t?qs(t):"null";return e+":"+r+":"+n}const sr=new To;let Ve=0;const Me=0,K=1<<Ve++,w=1<<Ve++,oe=1<<Ve++,W=1<<Ve++,Ye=1<<Ve++,Q=Math.pow(2,Ve)-1,or={[K]:"boolean",[w]:"number",[oe]:"string",[W]:"color",[Ye]:"number[]"},Ro=Object.keys(or).map(Number).sort(bn);function B(r){const e=[];for(const t of Ro)vo(r,t)&&e.push(or[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function vo(r,e){return(r&e)===e}function ue(r,e){return!!(r&e)}function dt(r,e){return r===e}class Pe{constructor(e,t){this.type=e,this.value=t}}class ar{constructor(e,t,...n){this.type=e,this.operator=t,this.args=n}}function xo(){return{variables:new Set,properties:new Set,featureId:!1,style:{}}}function Co(r){switch(r){case"string":return oe;case"color":return W;case"number":return w;case"boolean":return K;case"number[]":return Ye;default:throw new Error(`Unrecognized type hint: ${r}`)}}function U(r,e,t){switch(typeof r){case"boolean":return new Pe(K,r);case"number":return new Pe(w,r);case"string":{let i=oe;return to(r)&&(i|=W),dt(i&t,Me)||(i&=t),new Pe(i,r)}}if(!Array.isArray(r))throw new Error("Expression must be an array or a primitive value");if(r.length===0)throw new Error("Empty expression");if(typeof r[0]=="string")return No(r,e,t);for(const i of r)if(typeof i!="number")throw new Error("Expected an array of numbers");let n=Ye;return(r.length===3||r.length===4)&&(n|=W),t&&(n&=t),new Pe(n,r)}const T={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette"},wo={[T.Get]:L(([r,e])=>e!==void 0?Co(e.value):Q,P(1,2),Io),[T.Var]:L(([r])=>r.type,P(1,1),bo),[T.Id]:L(w|oe,et,Lo),[T.Concat]:L(oe,P(2,1/0),M(Q)),[T.GeometryType]:L(oe,et),[T.Resolution]:L(w,et),[T.Zoom]:L(w,et),[T.Time]:L(w,et),[T.Any]:L(K,P(2,1/0),M(K)),[T.All]:L(K,P(2,1/0),M(K)),[T.Not]:L(K,P(1,1),M(K)),[T.Equal]:L(K,P(2,2),M(Q),Le),[T.NotEqual]:L(K,P(2,2),M(Q),Le),[T.GreaterThan]:L(K,P(2,2),M(Q),Le),[T.GreaterThanOrEqualTo]:L(K,P(2,2),M(Q),Le),[T.LessThan]:L(K,P(2,2),M(Q),Le),[T.LessThanOrEqualTo]:L(K,P(2,2),M(Q),Le),[T.Multiply]:L(r=>{let e=w|W;for(let t=0;t<r.length;t++)e&=r[t].type;return e},P(2,1/0),M(w|W),Le),[T.Divide]:L(w,P(2,2),M(w)),[T.Add]:L(w,P(2,1/0),M(w)),[T.Subtract]:L(w,P(2,2),M(w)),[T.Clamp]:L(w,P(3,3),M(w)),[T.Mod]:L(w,P(2,2),M(w)),[T.Pow]:L(w,P(2,2),M(w)),[T.Abs]:L(w,P(1,1),M(w)),[T.Floor]:L(w,P(1,1),M(w)),[T.Ceil]:L(w,P(1,1),M(w)),[T.Round]:L(w,P(1,1),M(w)),[T.Sin]:L(w,P(1,1),M(w)),[T.Cos]:L(w,P(1,1),M(w)),[T.Atan]:L(w,P(1,2),M(w)),[T.Sqrt]:L(w,P(1,1),M(w)),[T.Match]:L(r=>{let e=Q;for(let t=2;t<r.length;t+=2)e&=r[t].type;return e&=r[r.length-1].type,e},P(4,1/0),vi,So),[T.Between]:L(K,P(3,3),M(w)),[T.Interpolate]:L(r=>{let e=W|w;for(let t=3;t<r.length;t+=2)e&=r[t].type;return e},P(6,1/0),vi,Po),[T.Case]:L(r=>{let e=Q;for(let t=1;t<r.length;t+=2)e&=r[t].type;return e&=r[r.length-1].type,e},P(3,1/0),Ao,Do),[T.In]:L(K,P(2,2),Oo),[T.Number]:L(w,P(1,1/0),M(Q)),[T.String]:L(oe,P(1,1/0),M(Q)),[T.Array]:L(r=>r.length===3||r.length===4?Ye|W:Ye,P(1,1/0),M(w)),[T.Color]:L(W,P(3,4),M(w)),[T.Band]:L(w,P(1,3),M(w)),[T.Palette]:L(W,P(2,2),Mo)};function Io(r,e){const t=U(r[1],e);if(!(t instanceof Pe))throw new Error("Expected a literal argument for get operation");if(typeof t.value!="string")throw new Error("Expected a string argument for get operation");if(e.properties.add(t.value),r.length===3){const n=U(r[2],e);return[t,n]}return[t]}function bo(r,e,t,n){const i=r[1];if(typeof i!="string")throw new Error("Expected a string argument for var operation");if(e.variables.add(i),!("variables"in e.style)||e.style.variables[i]===void 0)return[new Pe(Q,i)];const s=e.style.variables[i],o=U(s,e);if(o.value=i,n&&!ue(n,o.type))throw new Error(`The variable ${i} has type ${B(o.type)} but the following type was expected: ${B(n)}`);return[o]}function Lo(r,e){e.featureId=!0}function et(r,e){const t=r[0];if(r.length!==1)throw new Error(`Expected no arguments for ${t} operation`);return[]}function P(r,e){return function(t,n){const i=t[0],s=t.length-1;if(r===e){if(s!==r){const o=r===1?"":"s";throw new Error(`Expected ${r} argument${o} for ${i}, got ${s}`)}}else if(s<r||s>e){const o=e===1/0?`${r} or more`:`${r} to ${e}`;throw new Error(`Expected ${o} arguments for ${i}, got ${s}`)}}}function M(r){return function(e,t){const n=e[0],i=e.length-1,s=new Array(i);for(let o=0;o<i;++o){const a=U(e[o+1],t);if(!ue(r,a.type)){const l=B(r),h=B(a.type);throw new Error(`Unexpected type for argument ${o} of ${n} operation, got ${l} but expected ${h}`)}a.type&=r,s[o]=a}return s}}function Le(r,e,t){const n=r[0],i=r.length-1;let s=Q;for(let a=0;a<t.length;++a)s&=t[a].type;if(s===Me)throw new Error(`No common type could be found for arguments of ${n} operation`);const o=new Array(i);for(let a=0;a<i;++a)o[a]=U(r[a+1],e,s);return o}function Ao(r,e){const t=r[0],n=r.length-1;if(n%2===0)throw new Error(`An odd amount of arguments was expected for operation ${t}, got ${JSON.stringify(n)} instead`)}function vi(r,e){const t=r[0],n=r.length-1;if(n%2===1)throw new Error(`An even amount of arguments was expected for operation ${t}, got ${JSON.stringify(n)} instead`)}function So(r,e,t,n){const i=r.length-1;let o=U(r[1],e).type;const a=U(r[r.length-1],e);let l=n!==void 0?n&a.type:a.type;const h=new Array(i-2);for(let u=0;u<i-2;u+=2){const d=U(r[u+2],e),g=U(r[u+3],e);o&=d.type,l&=g.type,h[u]=d,h[u+1]=g}const c=oe|w|K;if(!ue(c,o))throw new Error(`Expected an input of type ${B(c)} for the interpolate operation, got ${B(o)} instead`);if(dt(l,Me))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(r));for(let u=0;u<i-2;u+=2){const d=U(r[u+2],e,o),g=U(r[u+3],e,l);h[u]=d,h[u+1]=g}return[U(r[1],e,o),...h,U(r[r.length-1],e,l)]}function Po(r,e,t,n){const i=r[1];let s;switch(i[0]){case"linear":s=1;break;case"exponential":if(s=i[1],typeof s!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(s)} instead`);break;default:s=null}if(!s)throw new Error(`Invalid interpolation type: ${JSON.stringify(i)}`);s=U(s,e);let o=U(r[2],e);if(!ue(w,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${B(o.type)} instead`);o=U(r[2],e,w);const a=new Array(r.length-3);for(let l=0;l<a.length;l+=2){let h=U(r[l+3],e);if(!ue(w,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${B(h.type)} at position ${l+2} instead`);let c=U(r[l+4],e);if(!ue(w|W,c.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${B(c.type)} at position ${l+3} instead`);h=U(r[l+3],e,w),c=U(r[l+4],e,w|W),a[l]=h,a[l+1]=c}return[s,o,...a]}function Do(r,e,t,n){const i=U(r[r.length-1],e);let s=n!==void 0?n&i.type:i.type;const o=new Array(r.length-1);for(let a=0;a<o.length-1;a+=2){const l=U(r[a+1],e),h=U(r[a+2],e);if(!ue(K,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${B(l.type)} at position ${a} instead`);s&=h.type,o[a]=l,o[a+1]=h}if(dt(s,Me))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(r));for(let a=0;a<o.length-1;a+=2)o[a+1]=U(r[a+2],e,s);return o[o.length-1]=U(r[r.length-1],e,s),o}function Oo(r,e){let t=r[2];if(!Array.isArray(t))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof t[0]=="string"){if(t[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(t[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');t=t[1]}let n=oe|w;const i=new Array(t.length);for(let o=0;o<i.length;o++){const a=U(t[o],e);n&=a.type,i[o]=a}if(dt(n,Me))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(r));return[U(r[1],e,n),...i]}function Mo(r,e){const t=U(r[1],e,w);if(t.type!==w)throw new Error(`The first argument of palette must be an number, got ${B(t.type)} instead`);const n=r[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");const i=new Array(n.length);for(let s=0;s<i.length;s++){const o=U(n[s],e,W);if(!(o instanceof Pe))throw new Error(`The palette color at index ${s} must be a literal value`);if(!ue(o.type,W))throw new Error(`The palette color at index ${s} should be of type color, got ${B(o.type)} instead`);i[s]=o}return[t,...i]}function L(r,...e){return function(t,n,i){const s=t[0];let o=[];for(let l=0;l<e.length;l++)o=e[l](t,n,o,i)||o;let a=typeof r=="function"?r(o):r;if(i!==void 0){if(!ue(a,i))throw new Error(`The following expression was expected to return ${B(i)}, but returns ${B(a)} instead: ${JSON.stringify(t)}`);a&=i}if(a===Me)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(t)}`);return new ar(a,s,...o)}}function No(r,e,t){const n=r[0],i=wo[n];if(!i)throw new Error(`Unknown operator: ${n}`);return i(r,e,t)}class Fo extends ut{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return k()}getData(e){return null}prepareFrame(e){return k()}renderFrame(e,t){return k()}loadedTileCallback(e,t,n){e[t]||(e[t]={}),e[t][n.tileCoord.toString()]=n}createLoadedTileFinder(e,t,n){return(i,s)=>{const o=this.loadedTileCallback.bind(this,n,i);return e.forEachLoadedTile(t,i,s,o)}}forEachFeatureAtCoordinate(e,t,n,i,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===Fe.LOADED||t.getState()===Fe.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=Fe.LOADED&&t!=Fe.ERROR&&e.addEventListener(S.CHANGE,this.boundHandleImageChange_),t==Fe.IDLE&&(e.load(),t=e.getState()),t==Fe.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}class xt extends Ie{constructor(e,t,n,i){super(e),this.inversePixelTransform=t,this.frameState=n,this.context=i}}class Uo extends pe{constructor(e){super(),this.projection=ht(e.projection),this.attributions_=xi(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(n,i){t.viewResolver=n,t.viewRejector=i})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=xi(e),this.changed()}setState(e){this.state_=e,this.changed()}}function xi(r){return r?Array.isArray(r)?function(e){return r}:typeof r=="function"?r:function(e){return[r]}:null}const x={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class kn extends Gt{constructor(e,t,n){super(),n=n||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(S.CHANGE)}release(){this.state===x.ERROR&&this.setState(x.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let e=this.interimTile;if(!e)return this;do{if(e.getState()==x.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){let e=this.interimTile;if(!e)return;let t=this;do{if(e.getState()==x.LOADED){e.interimTile=null;break}e.getState()==x.LOADING?t=e:e.getState()==x.IDLE?t.interimTile=e.interimTile:t=e,e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==x.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){k()}getAlpha(e,t){if(!this.transition_)return 1;let n=this.transitionStarts_[e];if(!n)n=t,this.transitionStarts_[e]=n;else if(n===-1)return 1;const i=t-n+1e3/60;return i>=this.transition_?1:rr(i/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}class jn extends kn{constructor(e,t,n,i,s,o){super(e,t,o),this.crossOrigin_=i,this.src_=n,this.key=n,this.image_=new Image,i!==null&&(this.image_.crossOrigin=i),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(e){this.image_=e,this.state=x.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=x.ERROR,this.unlistenImage_(),this.image_=Go(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=x.LOADED:this.state=x.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==x.ERROR&&(this.state=x.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==x.IDLE&&(this.state=x.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=yo(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function Go(){const r=Oe(1,1);return r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1),r.canvas}class Xo{constructor(e,t,n){this.decay_=e,this.minVelocity_=t,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let n=t-3;for(;n>0&&this.points_[n+2]>e;)n-=3;const i=this.points_[t+2]-this.points_[n+2];if(i<1e3/60)return!1;const s=this.points_[t]-this.points_[n],o=this.points_[t+1]-this.points_[n+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/i,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class zo extends Ft{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){k()}calculateMatrices2D(e){const t=e.viewState,n=e.coordinateToPixelTransform,i=e.pixelToCoordinateTransform;zt(n,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),Cs(i,n)}forEachFeatureAtCoordinate(e,t,n,i,s,o,a,l){let h;const c=t.viewState;function u(y,R,C,I){return s.call(o,R,y?C:null,I)}const d=c.projection,g=Hr(e.slice(),d),f=[[0,0]];if(d.canWrapX()&&i){const y=d.getExtent(),R=H(y);f.push([-R,0],[R,0])}const _=t.layerStatesArray,p=_.length,E=[],m=[];for(let y=0;y<f.length;y++)for(let R=p-1;R>=0;--R){const C=_[R],I=C.layer;if(I.hasRenderer()&&Xn(C,c)&&a.call(l,I)){const b=I.getRenderer(),O=I.getSource();if(b&&O){const G=O.getWrapX()?g:e,z=u.bind(null,C.managed);m[0]=G[0]+f[y][0],m[1]=G[1]+f[y][1],h=b.forEachFeatureAtCoordinate(m,t,n,z,E)}if(h)return h}}if(E.length===0)return;const v=1/E.length;return E.forEach((y,R)=>y.distanceSq+=R*v),E.sort((y,R)=>y.distanceSq-R.distanceSq),E.some(y=>h=y.callback(y.feature,y.layer,y.geometry)),h}hasFeatureAtCoordinate(e,t,n,i,s,o){return this.forEachFeatureAtCoordinate(e,t,n,i,It,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(e){k()}flushDeclutterItems(e){}scheduleExpireIconCache(e){sr.canExpireCache()&&e.postRenderFunctions.push(ko)}}function ko(r,e){sr.expire()}class jo extends zo{constructor(e){super(e),this.fontChangeListenerKey_=F(ro,st.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=kt+" ol-layers";const n=e.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(e,t){const n=this.getMap();if(n.hasListener(e)){const i=new xt(e,void 0,t);n.dispatchEvent(i)}}disposeInternal(){j(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(ne.PRECOMPOSE,e);const t=e.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),n=e.viewState;this.children_.length=0;const i=this.declutterLayers_;i.length=0;let s=null;for(let o=0,a=t.length;o<a;++o){const l=t[o];e.layerIndex=o;const h=l.layer,c=h.getSourceState();if(!Xn(l,n)||c!="ready"&&c!="undefined"){h.unrender();continue}const u=h.render(e,s);u&&(u!==s&&(this.children_.push(u),s=u),"getDeclutter"in h&&i.push(h))}this.flushDeclutterItems(e),io(this.element_,this.children_),this.dispatchRenderEvent(ne.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}flushDeclutterItems(e){const t=this.declutterLayers_;for(let n=t.length-1;n>=0;--n)t[n].renderDeclutter(e);t.length=0}}class xe extends Ie{constructor(e,t){super(e),this.layer=t}}const tn={LAYERS:"layers"};class We extends ir{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let n=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(tn.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new fe(n.slice(),{unique:!0}):X(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new fe(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(j),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(F(e,te.ADD,this.handleLayersAdd_,this),F(e,te.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(j);ct(this.listenerKeys_);const t=e.getArray();for(let n=0,i=t.length;n<i;n++){const s=t[n];this.registerLayerListeners_(s),this.dispatchEvent(new xe("addlayer",s))}this.changed()}registerLayerListeners_(e){const t=[F(e,st.PROPERTYCHANGE,this.handleLayerChange_,this),F(e,S.CHANGE,this.handleLayerChange_,this)];e instanceof We&&t.push(F(e,"addlayer",this.handleLayerGroupAdd_,this),F(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Y(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new xe("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new xe("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new xe("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,n=Y(t);this.listenerKeys_[n].forEach(j),delete this.listenerKeys_[n],this.dispatchEvent(new xe("removelayer",t)),this.changed()}getLayers(){return this.get(tn.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const n=t.getArray();for(let i=0,s=n.length;i<s;++i)this.dispatchEvent(new xe("removelayer",n[i]))}this.set(tn.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],n=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const i=this.getLayerState();let s=i.zIndex;!e&&i.zIndex===void 0&&(s=0);for(let o=n,a=t.length;o<a;o++){const l=t[o];l.opacity*=i.opacity,l.visible=l.visible&&i.visible,l.maxResolution=Math.min(l.maxResolution,i.maxResolution),l.minResolution=Math.max(l.minResolution,i.minResolution),l.minZoom=Math.max(l.minZoom,i.minZoom),l.maxZoom=Math.min(l.maxZoom,i.maxZoom),i.extent!==void 0&&(l.extent!==void 0?l.extent=ce(l.extent,i.extent):l.extent=i.extent),l.zIndex===void 0&&(l.zIndex=s)}return t}getSourceState(){return"ready"}}class je extends Ie{constructor(e,t,n){super(e),this.map=t,this.frameState=n!==void 0?n:null}}class Re extends je{constructor(e,t,n,i,s,o){super(e,t,s),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=i!==void 0?i:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Z={SINGLECLICK:"singleclick",CLICK:S.CLICK,DBLCLICK:S.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},yn={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class Zo extends Gt{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=F(n,yn.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=F(n,yn.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(S.TOUCHMOVE,this.boundHandleTouchMove_,Ki?{passive:!1}:!1)}emulateClick_(e){let t=new Re(Z.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new Re(Z.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new Re(Z.SINGLECLICK,this.map_,e);this.dispatchEvent(n)},250)}updateActivePointers_(e){const t=e,n=t.pointerId;if(t.type==Z.POINTERUP||t.type==Z.POINTERCANCEL){delete this.trackedTouches_[n];for(const i in this.trackedTouches_)if(this.trackedTouches_[i].target!==t.target){delete this.trackedTouches_[i];break}}else(t.type==Z.POINTERDOWN||t.type==Z.POINTERMOVE)&&(this.trackedTouches_[n]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new Re(Z.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(j),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new Re(Z.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(F(n,Z.POINTERMOVE,this.handlePointerMove_,this),F(n,Z.POINTERUP,this.handlePointerUp_,this),F(this.element_,Z.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(F(this.element_.getRootNode(),Z.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new Re(Z.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new Re(Z.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(j(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(S.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(j(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(j),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const ve={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},V={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},St=1/0;class Ko{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,ct(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,n=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const i=this.keyFunction_(n);return delete this.queuedElements_[i],n}enqueue(e){X(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=St?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,n=this.priorities_,i=t.length,s=t[e],o=n[e],a=e;for(;e<i>>1;){const l=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),c=h<i&&n[h]<n[l]?h:l;t[e]=t[c],n[e]=n[c],e=c}t[e]=s,n[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const n=this.elements_,i=this.priorities_,s=n[t],o=i[t];for(;t>e;){const a=this.getParentIndex_(t);if(i[a]>o)n[t]=n[a],i[t]=i[a],t=a;else break}n[t]=s,i[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,n=this.priorities_;let i=0;const s=t.length;let o,a,l;for(a=0;a<s;++a)o=t[a],l=e(o),l==St?delete this.queuedElements_[this.keyFunction_(o)]:(n[i]=l,t[i++]=o);t.length=i,n.length=i,this.heapify_()}}class $o extends Ko{constructor(e,t){super(function(n){return e.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(S.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,n=t.getState();if(n===x.LOADED||n===x.ERROR||n===x.EMPTY){n!==x.ERROR&&t.removeEventListener(S.CHANGE,this.boundHandleTileChange_);const i=t.getKey();i in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[i],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let n=0,i,s,o;for(;this.tilesLoading_<e&&n<t&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),i=s.getState(),i===x.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,s.load())}}function Yo(r,e,t,n,i){if(!r||!(t in r.wantedTiles)||!r.wantedTiles[t][e.getKey()])return St;const s=r.viewState.center,o=n[0]-s[0],a=n[1]-s[1];return 65536*Math.log(i)+Math.sqrt(o*o+a*a)/i}class Zn extends pe{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){En(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&En(this.element);for(let t=0,n=this.listenerKeys.length;t<n;++t)j(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==bt&&this.listenerKeys.push(F(e,ve.POSTRENDER,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class Bo extends Zn{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",n=e.tipLabel!==void 0?e.tipLabel:"Attributions",i=e.expandClassName!==void 0?e.expandClassName:t+"-expand",s=e.collapseLabel!==void 0?e.collapseLabel:"",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=i):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(S.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+kt+" "+Mn+(this.collapsed_&&this.collapsible_?" "+pi:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(i=>i.getAttributions(e)))),n=!this.getMap().getAllLayers().some(i=>i.getSource()&&i.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(n),t}updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=this.collectSourceAttributions_(e),n=t.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!An(t,this.renderedAttributions_)){no(this.ulElement_);for(let i=0,s=t.length;i<s;++i){const o=document.createElement("li");o.innerHTML=t[i],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(pi),this.collapsed_?mi(this.collapseLabel_,this.label_):mi(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}const Vo=Bo;class Wo extends Zn{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",n=e.label!==void 0?e.label:"",i=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=i,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(i));const s=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(S.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+kt+" "+Mn,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Et)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const n=t.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:Be}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const n=t.viewState.rotation;if(n!=this.rotation_){const i="rotate("+n+"rad)";if(this.autoHide_){const s=this.element.classList.contains(Et);!s&&n===0?this.element.classList.add(Et):s&&n!==0&&this.element.classList.remove(Et)}this.label_.style.transform=i}this.rotation_=n}}const Ho=Wo;class qo extends Zn{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",n=e.delta!==void 0?e.delta:1,i=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",s=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=i,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(S.CLICK,this.handleClick_.bind(this,n),!1);const u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(S.CLICK,this.handleClick_.bind(this,-n),!1);const d=t+" "+kt+" "+Mn,g=this.element;g.className=d,g.appendChild(c),g.appendChild(u),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const n=this.getMap().getView();if(!n)return;const i=n.getZoom();if(i!==void 0){const s=n.getConstrainedZoom(i+e);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:s,duration:this.duration_,easing:Be})):n.setZoom(s)}}}const Qo=qo;function Jo(r){r=r||{};const e=new fe;return(r.zoom!==void 0?r.zoom:!0)&&e.push(new Qo(r.zoomOptions)),(r.rotate!==void 0?r.rotate:!0)&&e.push(new Ho(r.rotateOptions)),(r.attribution!==void 0?r.attribution:!0)&&e.push(new Vo(r.attributionOptions)),e}const Ci={ACTIVE:"active"};class gt extends pe{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Ci.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(Ci.ACTIVE,e)}setMap(e){this.map_=e}}function ea(r,e,t){const n=r.getCenterInternal();if(n){const i=[n[0]+e[0],n[1]+e[1]];r.animateInternal({duration:t!==void 0?t:250,easing:go,center:r.getConstrainedCenter(i)})}}function Kn(r,e,t,n){const i=r.getZoom();if(i===void 0)return;const s=r.getConstrainedZoom(i+e),o=r.getResolutionForZoom(s);r.getAnimating()&&r.cancelAnimations(),r.animate({resolution:o,anchor:t,duration:n!==void 0?n:250,easing:Be})}class ta extends gt{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==Z.DBLCLICK){const n=e.originalEvent,i=e.map,s=e.coordinate,o=n.shiftKey?-this.delta_:this.delta_,a=i.getView();Kn(a,o,s,this.duration_),n.preventDefault(),t=!0}return!t}}const na=ta;class ft extends gt{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==Z.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==Z.POINTERUP){const n=this.handleUpEvent(e);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(e.type==Z.POINTERDOWN){const n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==Z.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function $n(r){const e=r.length;let t=0,n=0;for(let i=0;i<e;i++)t+=r[i].clientX,n+=r[i].clientY;return{clientX:t/e,clientY:n/e}}function Tn(r){const e=arguments;return function(t){let n=!0;for(let i=0,s=e.length;i<s&&(n=n&&e[i](t),!!n);++i);return n}}const ia=function(r){const e=r.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},ra=function(r){const e=r.map.getTargetElement(),t=r.map.getOwnerDocument().activeElement;return e.contains(t)},lr=function(r){return r.map.getTargetElement().hasAttribute("tabindex")?ra(r):!0},sa=It,hr=function(r){const e=r.originalEvent;return e.button==0&&!(Es&&ji&&e.ctrlKey)},cr=function(r){const e=r.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},oa=function(r){const e=r.originalEvent;return ji?e.metaKey:e.ctrlKey},aa=function(r){const e=r.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},ur=function(r){const e=r.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},nn=function(r){const e=r.originalEvent;return X(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.pointerType=="mouse"},la=function(r){const e=r.originalEvent;return X(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.isPrimary&&e.button===0};class ha extends ft{constructor(e){super({stopDown:Ut}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:Tn(cr,la);this.condition_=e.onFocusOnly?Tn(lr,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const n=this.targetPointers,i=t.getEventPixel($n(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){const s=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],a=e.map.getView();qr(s,a.getResolution()),wn(s,a.getRotation()),a.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,n=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const i=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=n.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-i*Math.cos(s),a[1]-i*Math.sin(s)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:Be})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const n=e.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const ca=ha;class ua extends ft{constructor(e){e=e||{},super({stopDown:Ut}),this.condition_=e.condition?e.condition:ia,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!nn(e))return;const t=e.map,n=t.getView();if(n.getConstraints().rotation===Gn)return;const i=t.getSize(),s=e.pixel,o=Math.atan2(i[1]/2-s[1],s[0]-i[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return nn(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return nn(e)&&hr(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class da extends Ft{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,n="px",i=this.element_.style;i.left=Math.min(e[0],t[0])+n,i.top=Math.min(e[1],t[1])+n,i.width=Math.abs(t[0]-e[0])+n,i.height=Math.abs(t[1]-e[1])+n}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,i=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new at([i])}getGeometry(){return this.geometry_}}const Tt={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class rn extends Ie{constructor(e,t,n){super(e),this.coordinate=t,this.mapBrowserEvent=n}}class ga extends ft{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new da(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:hr,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,n){const i=n[0]-t[0],s=n[1]-t[1];return i*i+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new rn(Tt.BOXDRAG,e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new rn(t?Tt.BOXEND:Tt.BOXCANCEL,e.coordinate,e)),!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new rn(Tt.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}}class fa extends ga{constructor(e){e=e||{};const t=e.condition?e.condition:aa;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const n=this.getMap().getView();let i=this.getGeometry();if(this.out_){const s=n.rotatedExtentForGeometry(i),o=n.getResolutionForExtentInternal(s),a=n.getResolution()/o;i=i.clone(),i.scale(a*a)}n.fitInternal(i,{duration:this.duration_,easing:Be})}}const _a=fa,Ae={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class ma extends gt{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return cr(t)&&ur(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==S.KEYDOWN){const n=e.originalEvent,i=n.key;if(this.condition_(e)&&(i==Ae.DOWN||i==Ae.LEFT||i==Ae.RIGHT||i==Ae.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;i==Ae.DOWN?h=-a:i==Ae.LEFT?l=-a:i==Ae.RIGHT?l=a:h=a;const c=[l,h];wn(c,o.getRotation()),ea(o,c,this.duration_),n.preventDefault(),t=!0}}return!t}}class pa extends gt{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!oa(t)&&ur(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==S.KEYDOWN||e.type==S.KEYPRESS){const n=e.originalEvent,i=n.key;if(this.condition_(e)&&(i==="+"||i==="-")){const s=e.map,o=i==="+"?this.delta_:-this.delta_,a=s.getView();Kn(a,o,void 0,this.duration_),n.preventDefault(),t=!0}}return!t}}const Ea=pa;class ya extends gt{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:sa;this.condition_=e.onFocusOnly?Tn(lr,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==S.WHEEL)return!0;const n=e.map,i=e.originalEvent;i.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);let s;if(e.type==S.WHEEL&&(s=i.deltaY,_s&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=Zi),i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const a=n.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=s;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let n=-$(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),Kn(t,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}const Ta=ya;class Ra extends ft{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Ut),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const n=this.targetPointers[0],i=this.targetPointers[1],s=Math.atan2(i.clientY-n.clientY,i.clientX-n.clientX);if(this.lastAngle_!==void 0){const l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=s;const o=e.map,a=o.getView();a.getConstraints().rotation!==Gn&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel($n(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class va extends ft{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Ut),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const n=this.targetPointers[0],i=this.targetPointers[1],s=n.clientX-i.clientX,o=n.clientY-i.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,h=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel($n(this.targetPointers))),l.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const n=e.map.getView(),i=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,i),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const xa=va;function Ca(r){r=r||{};const e=new fe,t=new Xo(-.005,.05,100);return(r.altShiftDragRotate!==void 0?r.altShiftDragRotate:!0)&&e.push(new ua),(r.doubleClickZoom!==void 0?r.doubleClickZoom:!0)&&e.push(new na({delta:r.zoomDelta,duration:r.zoomDuration})),(r.dragPan!==void 0?r.dragPan:!0)&&e.push(new ca({onFocusOnly:r.onFocusOnly,kinetic:t})),(r.pinchRotate!==void 0?r.pinchRotate:!0)&&e.push(new Ra),(r.pinchZoom!==void 0?r.pinchZoom:!0)&&e.push(new xa({duration:r.zoomDuration})),(r.keyboard!==void 0?r.keyboard:!0)&&(e.push(new ma),e.push(new Ea({delta:r.zoomDelta,duration:r.zoomDuration}))),(r.mouseWheelZoom!==void 0?r.mouseWheelZoom:!0)&&e.push(new Ta({onFocusOnly:r.onFocusOnly,duration:r.zoomDuration})),(r.shiftDragZoom!==void 0?r.shiftDragZoom:!0)&&e.push(new _a({duration:r.zoomDuration})),e}function dr(r){if(r instanceof zn){r.setMapInternal(null);return}r instanceof We&&r.getLayers().forEach(dr)}function gr(r,e){if(r instanceof zn){r.setMapInternal(e);return}if(r instanceof We){const t=r.getLayers().getArray();for(let n=0,i=t.length;n<i;++n)gr(t[n],e)}}class Ll extends pe{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=wa(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:Zi,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=De(),this.pixelToCoordinateTransform_=De(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||Jo(),this.interactions=t.interactions||Ca({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new $o(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(V.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(V.VIEW,this.handleViewChanged_),this.addChangeListener(V.SIZE,this.handleSizeChanged_),this.addChangeListener(V.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const n=this;e.view&&!(e.view instanceof le)&&e.view.then(function(i){n.setView(new le(i))}),this.controls.addEventListener(te.ADD,i=>{i.element.setMap(this)}),this.controls.addEventListener(te.REMOVE,i=>{i.element.setMap(null)}),this.interactions.addEventListener(te.ADD,i=>{i.element.setMap(this)}),this.interactions.addEventListener(te.REMOVE,i=>{i.element.setMap(null)}),this.overlays_.addEventListener(te.ADD,i=>{this.addOverlayInternal_(i.element)}),this.overlays_.addEventListener(te.REMOVE,i=>{const s=i.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],i.element.setMap(null)}),this.controls.forEach(i=>{i.setMap(this)}),this.interactions.forEach(i=>{i.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){gr(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,n){if(!this.frameState_||!this.renderer_)return;const i=this.getCoordinateFromPixelInternal(e);n=n!==void 0?n:{};const s=n.hitTolerance!==void 0?n.hitTolerance:0,o=n.layerFilter!==void 0?n.layerFilter:It,a=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(i,this.frameState_,s,a,t,null,o,null)}getFeaturesAtPixel(e,t){const n=[];return this.forEachFeatureAtPixel(e,function(i){n.push(i)},t),n}getAllLayers(){const e=[];function t(n){n.forEach(function(i){i instanceof We?t(i.getLayers()):e.push(i)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const i=t.layerFilter!==void 0?t.layerFilter:It,s=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,s,o,i,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const n=this.viewport_.getBoundingClientRect(),i=this.getSize(),s=n.width/i[0],o=n.height/i[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-n.left)/s,(a.clientY-n.top)/o]}getTarget(){return this.get(V.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return gn(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?pn(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(V.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof fe){t.setLayers(e);return}const n=t.getLayers();n.clear(),n.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){const i=e[t];if(!i.visible)continue;const s=i.layer.getRenderer();if(s&&!s.ready)return!0;const o=i.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=ge(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?pn(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(V.SIZE)}getView(){return this.get(V.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,n,i){return Yo(this.frameState_,e,t,n,i)}handleBrowserEvent(e,t){t=t||e.type;const n=new Re(t,this,e);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,n=t.type;if(n===yn.POINTERDOWN||n===S.WHEEL||n===S.KEYDOWN){const i=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():i,o=t.target;if(this.overlayContainerStopEvent_.contains(o)||!(s===i?i.documentElement:s).contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const i=this.getInteractions().getArray().slice();for(let s=i.length-1;s>=0;s--){const o=i[s];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let i=this.maxTilesLoading_,s=i;if(e){const o=e.viewHints;if(o[ee.ANIMATING]||o[ee.INTERACTING]){const a=Date.now()-e.time>8;i=a?0:8,s=a?0:2}}t.getTilesLoading()<i&&(t.reprioritize(),t.loadMoreTiles(i,s))}e&&this.renderer_&&!e.animate&&(this.renderComplete_===!0?(this.hasListener(ne.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(ne.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new je(ve.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new je(ve.LOADSTART,this,e))));const n=this.postRenderFunctions_;for(let i=0,s=n.length;i<s;++i)n[i](this,e);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,i=this.targetChangeHandlerKeys_.length;n<i;++n)j(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(S.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(S.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,En(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new jo(this)),this.mapBrowserEventHandler_=new Zo(this,this.moveTolerance_);for(const s in Z)this.mapBrowserEventHandler_.addEventListener(Z[s],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(S.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(S.WHEEL,this.boundHandleBrowserEvent_,Ki?{passive:!1}:!1);const n=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[F(n,S.KEYDOWN,this.handleBrowserEvent,this),F(n,S.KEYPRESS,this.handleBrowserEvent,this)];const i=t.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.observe(i.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(j(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(j(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=F(e,st.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=F(e,S.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(j),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new xe("addlayer",e)),this.layerGroupPropertyListenerKeys_=[F(e,st.PROPERTYCHANGE,this.render,this),F(e,S.CHANGE,this.render,this),F(e,"addlayer",this.handleLayerAdd_,this),F(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){const i=e[t].layer;i.hasRenderer()&&i.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}flushDeclutterItems(){const e=this.frameState_;e&&this.renderer_.flushDeclutterItems(e)}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){dr(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),n=this.getView(),i=this.frameState_;let s=null;if(t!==void 0&&gi(t)&&n&&n.isDef()){const o=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=n.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:fn(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:Y(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;s.nextExtent=fn(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),i&&(!this.previousExtent_||!Nt(this.previousExtent_)&&!ii(s.extent,this.previousExtent_))&&(this.dispatchEvent(new je(ve.MOVESTART,this,i)),this.previousExtent_=Ui(this.previousExtent_)),this.previousExtent_&&!s.viewHints[ee.ANIMATING]&&!s.viewHints[ee.INTERACTING]&&!ii(s.extent,this.previousExtent_)&&(this.dispatchEvent(new je(ve.MOVEEND,this,s)),Qr(s.extent,this.previousExtent_))),this.dispatchEvent(new je(ve.POSTRENDER,this,s)),this.renderComplete_=this.hasListener(ve.LOADSTART)||this.hasListener(ve.LOADEND)||this.hasListener(ne.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new xe("removelayer",t)),this.set(V.LAYERGROUP,e)}setSize(e){this.set(V.SIZE,e)}setTarget(e){this.set(V.TARGET,e)}setView(e){if(!e||e instanceof le){this.set(V.VIEW,e);return}this.set(V.VIEW,new le);const t=this;e.then(function(n){t.setView(new le(n))})}updateSize(){const e=this.getTargetElement();let t;if(e){const i=getComputedStyle(e),s=e.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),o=e.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);!isNaN(s)&&!isNaN(o)&&(t=[s,o],!gi(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&Jr("No map visible because the map container's width or height are 0."))}const n=this.getSize();t&&(!n||!An(t,n))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}}function wa(r){let e=null;r.keyboardEventTarget!==void 0&&(e=typeof r.keyboardEventTarget=="string"?document.getElementById(r.keyboardEventTarget):r.keyboardEventTarget);const t={},n=r.layers&&typeof r.layers.getLayers=="function"?r.layers:new We({layers:r.layers});t[V.LAYERGROUP]=n,t[V.TARGET]=r.target,t[V.VIEW]=r.view instanceof le?r.view:new le;let i;r.controls!==void 0&&(Array.isArray(r.controls)?i=new fe(r.controls.slice()):(X(typeof r.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),i=r.controls));let s;r.interactions!==void 0&&(Array.isArray(r.interactions)?s=new fe(r.interactions.slice()):(X(typeof r.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=r.interactions));let o;return r.overlays!==void 0?Array.isArray(r.overlays)?o=new fe(r.overlays.slice()):(X(typeof r.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=r.overlays):o=new fe,{controls:i,interactions:s,keyboardEventTarget:e,overlays:o,values:t}}class fr{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const n=this.entries_[e];return X(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(e){const t=this.entries_[e];return X(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.key_;return e}getValues(){const e=new Array(this.count_);let t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){var t;return(t=this.entries_[e])==null?void 0:t.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){X(!(e in this.entries_),"Tried to set a value for a key that is used already");const n={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[e]=n,++this.count_}setSize(e){this.highWaterMark=e}}function Pt(r,e,t,n){return n!==void 0?(n[0]=r,n[1]=e,n[2]=t,n):[r,e,t]}function jt(r,e,t){return r+"/"+e+"/"+t}function Ce(r){return jt(r[0],r[1],r[2])}function Ia(r){return r.split("/").map(Number)}function ba(r){return(r[1]<<r[0])+r[2]}function La(r,e){const t=r[0],n=r[1],i=r[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const s=e.getFullTileRange(t);return s?s.containsXY(n,i):!0}class _r extends fr{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),n=Ia(e)[0];this.forEach(i=>{i.tileCoord[0]!==n&&(this.remove(Ce(i.tileCoord)),i.release())})}}class Yn{constructor(e,t,n,i){this.minX=e,this.maxX=t,this.minY=n,this.maxY=i}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function Ue(r,e,t,n,i){return i!==void 0?(i.minX=r,i.maxX=e,i.minY=t,i.maxY=n,i):new Yn(r,e,t,n)}const mr=.5,Aa=10,wi=.25;class pr{constructor(e,t,n,i,s,o){this.sourceProj_=e,this.targetProj_=t;let a={};const l=dn(this.targetProj_,this.sourceProj_);this.transformInv_=function(m){const v=m[0]+"/"+m[1];return a[v]||(a[v]=l(m)),a[v]},this.maxSourceExtent_=i,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&H(i)>=H(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?H(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?H(this.targetProj_.getExtent()):null;const h=In(n),c=es(n),u=ts(n),d=ns(n),g=this.transformInv_(h),f=this.transformInv_(c),_=this.transformInv_(u),p=this.transformInv_(d),E=Aa+(o?Math.max(0,Math.ceil(Math.log2(rt(n)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,d,g,f,_,p,E),this.wrapsXInSource_){let m=1/0;this.triangles_.forEach(function(v,y,R){m=Math.min(m,v.source[0][0],v.source[1][0],v.source[2][0])}),this.triangles_.forEach(v=>{if(Math.max(v.source[0][0],v.source[1][0],v.source[2][0])-m>this.sourceWorldWidth_/2){const y=[[v.source[0][0],v.source[0][1]],[v.source[1][0],v.source[1][1]],[v.source[2][0],v.source[2][1]]];y[0][0]-m>this.sourceWorldWidth_/2&&(y[0][0]-=this.sourceWorldWidth_),y[1][0]-m>this.sourceWorldWidth_/2&&(y[1][0]-=this.sourceWorldWidth_),y[2][0]-m>this.sourceWorldWidth_/2&&(y[2][0]-=this.sourceWorldWidth_);const R=Math.min(y[0][0],y[1][0],y[2][0]);Math.max(y[0][0],y[1][0],y[2][0])-R<this.sourceWorldWidth_/2&&(v.source=y)}})}a={}}addTriangle_(e,t,n,i,s,o){this.triangles_.push({source:[i,s,o],target:[e,t,n]})}addQuad_(e,t,n,i,s,o,a,l,h){const c=mn([s,o,a,l]),u=this.sourceWorldWidth_?H(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&u>.5&&u<1;let f=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const p=mn([e,t,n,i]);f=H(p)/this.targetWorldWidth_>wi||f}!g&&this.sourceProj_.isGlobal()&&u&&(f=u>wi||f)}if(!f&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!xn(c,this.maxSourceExtent_))return;let _=0;if(!f&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)f=!0;else if(_=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(h>0){if(!f){const p=[(e[0]+n[0])/2,(e[1]+n[1])/2],E=this.transformInv_(p);let m;g?m=($e(s[0],d)+$e(a[0],d))/2-$e(E[0],d):m=(s[0]+a[0])/2-E[0];const v=(s[1]+a[1])/2-E[1];f=m*m+v*v>this.errorThresholdSquared_}if(f){if(Math.abs(e[0]-n[0])<=Math.abs(e[1]-n[1])){const p=[(t[0]+n[0])/2,(t[1]+n[1])/2],E=this.transformInv_(p),m=[(i[0]+e[0])/2,(i[1]+e[1])/2],v=this.transformInv_(m);this.addQuad_(e,t,p,m,s,o,E,v,h-1),this.addQuad_(m,p,n,i,v,E,a,l,h-1)}else{const p=[(e[0]+t[0])/2,(e[1]+t[1])/2],E=this.transformInv_(p),m=[(n[0]+i[0])/2,(n[1]+i[1])/2],v=this.transformInv_(m);this.addQuad_(e,p,m,i,s,E,v,l,h-1),this.addQuad_(p,t,n,m,E,o,a,v,h-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}_&11||this.addTriangle_(e,n,i,s,a,l),_&14||this.addTriangle_(e,n,t,s,a,o),_&&(_&13||this.addTriangle_(t,i,e,o,l,s),_&7||this.addTriangle_(t,i,n,o,l,a))}calculateSourceExtent(){const e=Mt();return this.triangles_.forEach(function(t,n,i){const s=t.source;Wt(e,s[0]),Wt(e,s[1]),Wt(e,s[2])}),e}getTriangles(){return this.triangles_}}let sn;const me=[];function Ii(r,e,t,n,i){r.beginPath(),r.moveTo(0,0),r.lineTo(e,t),r.lineTo(n,i),r.closePath(),r.save(),r.clip(),r.fillRect(0,0,Math.max(e,n)+1,Math.max(t,i)),r.restore()}function on(r,e){return Math.abs(r[e*4]-210)>2||Math.abs(r[e*4+3]-.75*255)>2}function Sa(){if(sn===void 0){const r=Oe(6,6,me);r.globalCompositeOperation="lighter",r.fillStyle="rgba(210, 0, 0, 0.75)",Ii(r,4,5,4,0),Ii(r,4,5,0,5);const e=r.getImageData(0,0,3,3).data;sn=on(e,0)||on(e,4)||on(e,8),lt(r),me.push(r.canvas)}return sn}function bi(r,e,t,n){const i=ss(t,e,r);let s=ri(e,n,t);const o=e.getMetersPerUnit();o!==void 0&&(s*=o);const a=r.getMetersPerUnit();a!==void 0&&(s/=a);const l=r.getExtent();if(!l||wt(l,i)){const h=ri(r,s,i)/s;isFinite(h)&&h>0&&(s/=h)}return s}function Er(r,e,t,n){const i=it(t);let s=bi(r,e,i,n);return(!isFinite(s)||s<=0)&&Xi(t,function(o){return s=bi(r,e,o,n),isFinite(s)&&s>0}),s}function yr(r,e,t,n,i,s,o,a,l,h,c,u,d){const g=Oe(Math.round(t*r),Math.round(t*e),me);if(u||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(t,t);function f(m){return Math.round(m*t)/t}g.globalCompositeOperation="lighter";const _=Mt();l.forEach(function(m,v,y){is(_,m.extent)});let p;if(!d||l.length!==1||h!==0){const m=H(_),v=_e(_);p=Oe(Math.round(t*m/n),Math.round(t*v/n),me),u||(p.imageSmoothingEnabled=!1);const y=t/n;l.forEach(function(R,C,I){const b=R.extent[0]-_[0],O=-(R.extent[3]-_[3]),G=H(R.extent),z=_e(R.extent);R.image.width>0&&R.image.height>0&&p.drawImage(R.image,h,h,R.image.width-2*h,R.image.height-2*h,b*y,O*y,G*y,z*y)})}const E=In(o);return a.getTriangles().forEach(function(m,v,y){const R=m.source,C=m.target;let I=R[0][0],b=R[0][1],O=R[1][0],G=R[1][1],z=R[2][0],ie=R[2][1];const re=f((C[0][0]-E[0])/s),ae=f(-(C[0][1]-E[1])/s),J=f((C[1][0]-E[0])/s),Ee=f(-(C[1][1]-E[1])/s),$t=f((C[2][0]-E[0])/s),Yt=f(-(C[2][1]-E[1])/s),Bt=I,Vt=b;I=0,b=0,O-=Bt,G-=Vt,z-=Bt,ie-=Vt;const Nr=[[O,G,0,0,J-re],[z,ie,0,0,$t-re],[0,0,O,G,Ee-ae],[0,0,z,ie,Yt-ae]],He=rs(Nr);if(!He)return;if(g.save(),g.beginPath(),Sa()||!u){g.moveTo(J,Ee);const de=4,Qe=re-J,ni=ae-Ee;for(let be=0;be<de;be++)g.lineTo(J+f((be+1)*Qe/de),Ee+f(be*ni/(de-1))),be!=de-1&&g.lineTo(J+f((be+1)*Qe/de),Ee+f((be+1)*ni/(de-1)));g.lineTo($t,Yt)}else g.moveTo(J,Ee),g.lineTo(re,ae),g.lineTo($t,Yt);g.clip(),g.transform(He[0],He[2],He[1],He[3],re,ae),g.translate(_[0]-Bt,_[3]-Vt);let qe;if(p)qe=p.canvas,g.scale(n/t,-n/t);else{const de=l[0],Qe=de.extent;qe=de.image,g.scale(H(Qe)/qe.width,-_e(Qe)/qe.height)}g.drawImage(qe,0,0),g.restore()}),p&&(lt(p),me.push(p.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(m,v,y){const R=m.target,C=(R[0][0]-E[0])/s,I=-(R[0][1]-E[1])/s,b=(R[1][0]-E[0])/s,O=-(R[1][1]-E[1])/s,G=(R[2][0]-E[0])/s,z=-(R[2][1]-E[1])/s;g.beginPath(),g.moveTo(b,O),g.lineTo(C,I),g.lineTo(G,z),g.closePath(),g.stroke()}),g.restore()),g.canvas}class Zt extends kn{constructor(e,t,n,i,s,o,a,l,h,c,u,d){super(s,x.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=i,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const g=i.getTileCoordExtent(this.wrappedTileCoord_),f=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const p=f?ce(g,f):g;if(rt(p)===0){this.state=x.EMPTY;return}const E=e.getExtent();E&&(_?_=ce(_,E):_=E);const m=i.getResolution(this.wrappedTileCoord_[0]),v=Er(e,n,p,m);if(!isFinite(v)||v<=0){this.state=x.EMPTY;return}const y=c!==void 0?c:mr;if(this.triangulation_=new pr(e,n,p,_,v*y,m),this.triangulation_.getTriangles().length===0){this.state=x.EMPTY;return}this.sourceZ_=t.getZForResolution(v);let R=this.triangulation_.calculateSourceExtent();if(_&&(e.canWrapX()?(R[1]=$(R[1],_[1],_[3]),R[3]=$(R[3],_[1],_[3])):R=ce(R,_)),!rt(R))this.state=x.EMPTY;else{const C=t.getTileRangeForExtentAndZ(R,this.sourceZ_);for(let I=C.minX;I<=C.maxX;I++)for(let b=C.minY;b<=C.maxY;b++){const O=h(this.sourceZ_,I,b,a);O&&this.sourceTiles_.push(O)}this.sourceTiles_.length===0&&(this.state=x.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==x.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=x.ERROR;else{const t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),i=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=yr(i,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=x.LOADED}this.changed()}load(){if(this.state==x.IDLE){this.state=x.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const n=t.getState();if(n==x.IDLE||n==x.LOADING){e++;const i=F(t,S.CHANGE,function(s){const o=t.getState();(o==x.LOADED||o==x.ERROR||o==x.EMPTY)&&(j(i),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(i)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,n,i){t.getState()==x.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(j),this.sourcesListenerKeys_=null}release(){this.canvas_&&(lt(this.canvas_.getContext("2d")),me.push(this.canvas_),this.canvas_=null),super.release()}}const an={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},Ge=[0,0,0],ye=5;class Bn{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,X(us(this.resolutions_,(i,s)=>s-i,!0),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let i=0,s=this.resolutions_.length-1;i<s;++i)if(!t)t=this.resolutions_[i]/this.resolutions_[i+1];else if(this.resolutions_[i]/this.resolutions_[i+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,X(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=e.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=In(n)),X(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,X(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:Nn,X(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((i,s)=>{const o=new Yn(Math.min(0,i[0]),Math.max(i[0]-1,-1),Math.min(0,i[1]),Math.max(i[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(e,t,n){const i=this.getTileRangeForExtentAndZ(e,t);for(let s=i.minX,o=i.maxX;s<=o;++s)for(let a=i.minY,l=i.maxY;a<=l;++a)n([t,s,a])}forEachTileCoordParentTileRange(e,t,n,i){let s,o,a,l=null,h=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,i);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),s=Ue(o,o,a,a,n)):s=this.getTileRangeForExtentAndZ(l,h,n),t(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,n){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const s=e[1]*2,o=e[2]*2;return Ue(s,s+1,o,o+1,t)}const i=this.getTileCoordExtent(e,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(i,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,n){if(t>this.maxZoom||t<this.minZoom)return null;const i=e[0],s=e[1],o=e[2];if(t===i)return Ue(s,o,s,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-i),h=Math.floor(s*l),c=Math.floor(o*l);if(t<i)return Ue(h,h,c,c,n);const u=Math.floor(l*(s+1))-1,d=Math.floor(l*(o+1))-1;return Ue(h,u,c,d,n)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,n)}getTileRangeForExtentAndZ(e,t,n){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,Ge);const i=Ge[1],s=Ge[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,Ge);const o=Ge[1],a=Ge[2];return Ue(i,o,s,a,n)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),n=this.getResolution(e[0]),i=he(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*i[0]*n,t[1]-(e[2]+.5)*i[1]*n]}getTileCoordExtent(e,t){const n=this.getOrigin(e[0]),i=this.getResolution(e[0]),s=he(this.getTileSize(e[0]),this.tmpSize_),o=n[0]+e[1]*s[0]*i,a=n[1]-(e[2]+1)*s[1]*i,l=o+s[0]*i,h=a+s[1]*i;return ki(o,a,l,h,t)}getTileCoordForCoordAndResolution(e,t,n){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,n)}getTileCoordForXYAndResolution_(e,t,n,i,s){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),h=he(this.getTileSize(o),this.tmpSize_);let c=a*(e-l[0])/n/h[0],u=a*(l[1]-t)/n/h[1];return i?(c=_t(c,ye)-1,u=_t(u,ye)-1):(c=mt(c,ye),u=mt(u,ye)),Pt(o,c,u,s)}getTileCoordForXYAndZ_(e,t,n,i,s){const o=this.getOrigin(n),a=this.getResolution(n),l=he(this.getTileSize(n),this.tmpSize_);let h=(e-o[0])/a/l[0],c=(o[1]-t)/a/l[1];return i?(h=_t(h,ye)-1,c=_t(c,ye)-1):(h=mt(h,ye),c=mt(c,ye)),Pt(n,h,c,s)}getTileCoordForCoordAndZ(e,t,n){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,n)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const n=Ln(this.resolutions_,e,t||0);return $(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Qi(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,n=new Array(t);for(let i=this.minZoom;i<t;++i)n[i]=this.getTileRangeForExtentAndZ(e,i);this.fullTileRanges_=n}}function Tr(r){let e=r.getDefaultTileGrid();return e||(e=Ma(r),r.setDefaultTileGrid(e)),e}function Pa(r,e,t){const n=e[0],i=r.getTileCoordCenter(e),s=Vn(t);if(!wt(s,i)){const o=H(s),a=Math.ceil((s[0]-i[0])/o);return i[0]+=o*a,r.getTileCoordForCoordAndZ(i,n)}return e}function Da(r,e,t,n){n=n!==void 0?n:"top-left";const i=Rr(r,e,t);return new Bn({extent:r,origin:os(r,n),resolutions:i,tileSize:t})}function Oa(r){const e=r||{},t=e.extent||ht("EPSG:3857").getExtent(),n={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Rr(t,e.maxZoom,e.tileSize,e.maxResolution)};return new Bn(n)}function Rr(r,e,t,n){e=e!==void 0?e:so,t=he(t!==void 0?t:Nn);const i=_e(r),s=H(r);n=n>0?n:Math.max(s/t[0],i/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function Ma(r,e,t,n){const i=Vn(r);return Da(i,e,t,n)}function Vn(r){r=ht(r);let e=r.getExtent();if(!e){const t=180*zi.degrees/r.getMetersPerUnit();e=ki(-t,-t,t,t)}return e}class Na extends Uo{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&he(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new _r(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const n=this.getTileCacheForProjection(e);n&&n.expireCache(t)}forEachLoadedTile(e,t,n,i){const s=this.getTileCacheForProjection(e);if(!s)return!1;let o=!0,a,l,h;for(let c=n.minX;c<=n.maxX;++c)for(let u=n.minY;u<=n.maxY;++u)l=jt(t,c,u),h=!1,s.containsKey(l)&&(a=s.get(l),h=a.getState()===x.LOADED,h&&(h=i(a)!==!1)),h||(o=!1);return o}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,n,i,s){return k()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:Tr(e)}getTileCacheForProjection(e){const t=this.getProjection();return X(t===null||ke(t,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,n){const i=this.getTileGridForProjection(n),s=this.getTilePixelRatio(t),o=he(i.getTileSize(e),this.tmpSize);return s==1?o:Bs(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const n=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=Pa(n,e,t)),La(e,n)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const n=this.getTileCacheForProjection(t);e>n.highWaterMark&&(n.highWaterMark=e)}useTile(e,t,n,i){}}class Fa extends Ie{constructor(e,t){super(e),this.tile=t}}function Ua(r,e){const t=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return r.replace(t,o[0].toString()).replace(n,o[1].toString()).replace(i,o[2].toString()).replace(s,function(){const h=o[0],c=e.getFullTileRange(h);if(!c)throw new Error("The {-y} placeholder requires a tile grid with extent");return(c.getHeight()-o[2]-1).toString()})}}function Ga(r,e){const t=r.length,n=new Array(t);for(let i=0;i<t;++i)n[i]=Ua(r[i],e);return Xa(n)}function Xa(r){return r.length===1?r[0]:function(e,t,n){if(!e)return;const i=ba(e),s=$e(i,r.length);return r[s](e,t,n)}}function za(r){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(r);if(t){const n=t[1].charCodeAt(0),i=t[2].charCodeAt(0);let s;for(s=n;s<=i;++s)e.push(r.replace(t[0],String.fromCharCode(s)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(r),t){const n=parseInt(t[2],10);for(let i=parseInt(t[1],10);i<=n;i++)e.push(r.replace(t[0],i.toString()));return e}return e.push(r),e}class Wn extends Na{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Wn.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,n=Y(t),i=t.getState();let s;i==x.LOADING?(this.tileLoadingKeys_[n]=!0,s=an.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=i==x.ERROR?an.TILELOADERROR:i==x.LOADED?an.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new Fa(s,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=za(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Ga(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,n){}useTile(e,t,n){const i=jt(e,t,n);this.tileCache.containsKey(i)&&this.tileCache.get(i)}}class ka extends Wn{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:ja,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:jn,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const n=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==n?t:{});for(const i in this.tileCacheForProjection){const s=this.tileCacheForProjection[i];s.expireCache(s==n?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!ke(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!ke(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||ke(t,e)))return this.tileGrid;const n=Y(e);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=Tr(e)),this.tileGridForProjection[n]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||ke(t,e))return this.tileCache;const n=Y(e);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new _r(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(e,t,n,i,s,o){const a=[e,t,n],l=this.getTileCoordForTileUrlFunction(a,s),h=l?this.tileUrlFunction(l,i,s):void 0,c=new this.tileClass(a,h!==void 0?x.IDLE:x.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(S.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,n,i,s){const o=this.getProjection();if(!o||!s||ke(o,s))return this.getTileInternal(e,t,n,i,o||s);const a=this.getTileCacheForProjection(s),l=[e,t,n];let h;const c=Ce(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;const d=this.getTileGridForProjection(o),g=this.getTileGridForProjection(s),f=this.getTileCoordForTileUrlFunction(l,s),_=new Zt(o,d,s,g,l,f,this.getTilePixelRatio(i),this.getGutter(),(p,E,m,v)=>this.getTileInternal(p,E,m,v,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return _.key=u,h?(_.interimTile=h,_.refreshInterimChain(),a.replace(c,_)):a.set(c,_),_}getTileInternal(e,t,n,i,s){let o=null;const a=jt(e,t,n),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(e,t,n,i,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(e,t,n,i,s,l),h.getState()==x.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const n=ht(e);if(n){const i=Y(n);i in this.tileGridForProjection||(this.tileGridForProjection[i]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function ja(r,e){r.getImage().src=e}class vr extends ka{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",n=e.tileGrid!==void 0?e.tileGrid:Oa({extent:Vn(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const Za='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Ka extends vr{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[Za];const n=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",i=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:n,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,opaque:e.opaque!==void 0?e.opaque:!0,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:i,wrapX:e.wrapX,zDirection:e.zDirection})}}const Rt={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class $a extends zn{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(Rt.PRELOAD)}setPreload(e){this.set(Rt.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(Rt.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(Rt.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}function Dt(r){return r instanceof Image||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageBitmap?r:null}function Rn(r){return r instanceof Uint8Array||r instanceof Uint8ClampedArray||r instanceof Float32Array||r instanceof DataView?r:null}let Xe=null;function Ya(r){Xe||(Xe=Oe(r.width,r.height,void 0,{willReadFrequently:!0}));const e=Xe.canvas,t=r.width;e.width!==t&&(e.width=t);const n=r.height;return e.height!==n&&(e.height=n),Xe.clearRect(0,0,t,n),Xe.drawImage(r,0,0),Xe.getImageData(0,0,t,n).data}const Ba=[256,256];class xr extends kn{constructor(e){const t=x.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null}getSize(){if(this.size_)return this.size_;const e=Dt(this.data_);return e?[e.width,e.height]:Ba}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==x.IDLE&&this.state!==x.ERROR)return;this.state=x.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=x.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=x.ERROR,e.changed()})}}class Cr extends xr{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:e.interpolate,transition:e.transition}),this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),n=this.targetTileGrid_.getExtent();let i=this.sourceTileGrid_.getExtent();const s=n?ce(t,n):t;if(rt(s)===0){this.state=x.EMPTY;return}const o=e.sourceProj,a=o.getExtent();a&&(i?i=ce(i,a):i=a);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=e.targetProj,c=Er(o,h,s,l);if(!isFinite(c)||c<=0){this.state=x.EMPTY;return}const u=e.errorThreshold!==void 0?e.errorThreshold:mr;if(this.triangulation_=new pr(o,h,s,i,c*u,l),this.triangulation_.getTriangles().length===0){this.state=x.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(c);let d=this.triangulation_.calculateSourceExtent();if(i&&(o.canWrapX()?(d[1]=$(d[1],i[1],i[3]),d[3]=$(d[3],i[1],i[3])):d=ce(d,i)),!rt(d))this.state=x.EMPTY;else{const g=this.sourceTileGrid_.getTileRangeForExtentAndZ(d,this.sourceZ_),f=e.getTileFunction;for(let _=g.minX;_<=g.maxX;_++)for(let p=g.minY;p<=g.maxY;p++){const E=f(this.sourceZ_,_,p,this.pixelRatio_);E&&this.sourceTiles_.push(E)}this.sourceTiles_.length===0&&(this.state=x.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{if(!t||t.getState()!==x.LOADED)return;const n=t.getSize(),i=this.gutter_;let s;const o=Rn(t.getData());o?s=o:s=Ya(Dt(t.getData()));const a=[n[0]+2*i,n[1]+2*i],l=s instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=new c(s.buffer),d=c.BYTES_PER_ELEMENT,g=d*u.length/h,f=u.byteLength/a[1],_=Math.floor(f/d/a[0]),p=h*_;let E=u;if(u.length!==p){E=new c(p);let m=0,v=0;const y=a[0]*_;for(let R=0;R<a[1];++R){for(let C=0;C<y;++C)E[m++]=u[v+C];v+=f/d}}e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),data:new Uint8Array(E.buffer),dataType:c,bytesPerPixel:g,pixelSize:a})}),this.sourceTiles_.length=0,e.length===0)this.state=x.ERROR;else{const t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),i=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let h,c;const u=e[0].bytesPerPixel,d=Math.ceil(u/3);for(let g=d-1;g>=0;--g){const f=[];for(let y=0,R=e.length;y<R;++y){const C=e[y],I=C.data,b=C.pixelSize,O=b[0],G=b[1],z=Oe(O,G,me),ie=z.createImageData(O,G),re=ie.data;let ae=g*3;for(let J=0,Ee=re.length;J<Ee;J+=4)re[J]=I[ae],re[J+1]=I[ae+1],re[J+2]=I[ae+2],re[J+3]=255,ae+=u;z.putImageData(ie,0,0),f.push({extent:C.extent,image:z.canvas})}const _=yr(i,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,f,this.gutter_,!1,!1);for(let y=0,R=f.length;y<R;++y){const I=f[y].image.getContext("2d");lt(I),me.push(I.canvas)}const p=_.getContext("2d"),E=p.getImageData(0,0,_.width,_.height);lt(p),me.push(_),h||(c=new Uint8Array(u*E.width*E.height),h=new e[0].dataType(c.buffer));const m=E.data;let v=g*3;for(let y=0,R=m.length;y<R;y+=4)m[y+3]===255?(c[v]=m[y],c[v+1]=m[y+1],c[v+2]=m[y+2]):(c[v]=0,c[v+1]=0,c[v+2]=0),v+=u}this.reprojData_=h,this.reprojSize_=[Math.round(i*this.pixelRatio_),Math.round(s*this.pixelRatio_)],this.state=x.LOADED}this.changed()}load(){if(this.state!==x.IDLE&&this.state!==x.ERROR)return;this.state=x.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const n=t.getState();if(n!==x.IDLE&&n!==x.LOADING)return;e++;const i=F(t,S.CHANGE,function(){const s=t.getState();(s==x.LOADED||s==x.ERROR||s==x.EMPTY)&&(j(i),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(i)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t){t.getState()==x.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(j),this.sourcesListenerKeys_=null}}class Va extends Gt{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=e.gutter||0,this.helper_=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(S.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===x.LOADED,this.loaded)this.uploadTile();else{if(e instanceof jn){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(S.CHANGE,this.handleTileChange_)}}uploadTile(){k()}setReady(){this.ready=!0,this.dispatchEvent(S.CHANGE)}handleTileChange_(){this.tile.getState()===x.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(S.CHANGE,this.handleTileChange_)}}const Hn=34962,qn=34963,Wa=35040,Qn=35044,Ha=35048,qa=5121,Qa=5123,Ja=5125,wr=5126,Li=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function el(r,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!ps},e);const t=Li.length;for(let n=0;n<t;++n)try{const i=r.getContext(Li[n],e);if(i)return i}catch{}return null}const tl={STATIC_DRAW:Qn,STREAM_DRAW:Wa,DYNAMIC_DRAW:Ha};class Ir{constructor(e,t){this.array_=null,this.type_=e,X(e===Hn||e===qn,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:tl.STATIC_DRAW}ofSize(e){return this.array_=new(ln(this.type_))(e),this}fromArray(e){return this.array_=ln(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(ln(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function ln(r){switch(r){case Hn:return Float32Array;case qn:return Uint32Array;default:return Float32Array}}function br(r,e,t){const n=t?r.LINEAR:r.NEAREST;r.bindTexture(r.TEXTURE_2D,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n)}function nl(r,e,t,n){br(r,e,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}function Ai(r,e,t,n,i,s){const o=r.getGL();let a,l;t instanceof Float32Array?(a=o.FLOAT,r.getExtension("OES_texture_float"),l=r.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),br(o,e,s&&l);const h=t.byteLength/n[1];let c=1;h%8===0?c=8:h%4===0?c=4:h%2===0&&(c=2);let u;switch(i){case 1:{u=o.LUMINANCE;break}case 2:{u=o.LUMINANCE_ALPHA;break}case 3:{u=o.RGB;break}case 4:{u=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${i}`)}const d=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,c),o.texImage2D(o.TEXTURE_2D,0,u,n[0],n[1],0,u,a,t),o.pixelStorei(o.UNPACK_ALIGNMENT,d)}let Ze=null;function il(){Ze=Oe(1,1,void 0,{willReadFrequently:!0})}class rl extends Va{constructor(e){super(e),this.textures=[],this.renderSize_=he(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new Ir(Hn,Qn);t.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(t),this.coords=t,this.setTile(e.tile)}uploadTile(){const e=this.helper_,t=e.getGL(),n=this.tile;this.textures.length=0;let i;n instanceof jn||n instanceof Zt?i=n.getImage():i=n.getData();const s=Dt(i);if(s){const m=t.createTexture();this.textures.push(m),this.bandCount=4,nl(t,m,s,n.interpolate),this.setReady();return}i=Rn(i);const o=n.getSize(),a=[o[0]+2*this.gutter_,o[1]+2*this.gutter_],l=i instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=c.BYTES_PER_ELEMENT,d=i.byteLength/a[1];this.bandCount=Math.floor(d/u/a[0]);const g=Math.ceil(this.bandCount/4);if(g===1){const m=t.createTexture();this.textures.push(m),Ai(e,m,i,a,this.bandCount,n.interpolate),this.setReady();return}const f=new Array(g);for(let m=0;m<g;++m){const v=t.createTexture();this.textures.push(v);const y=m<g-1?4:(this.bandCount-1)%4+1;f[m]=new c(h*y)}let _=0,p=0;const E=a[0]*this.bandCount;for(let m=0;m<a[1];++m){for(let v=0;v<E;++v){const y=i[p+v],R=Math.floor(_/this.bandCount),C=v%this.bandCount,I=Math.floor(C/4),b=f[I],O=b.length/h,G=C%4;b[R*O+G]=y,++_}p+=d/u}for(let m=0;m<g;++m){const v=this.textures[m],y=f[m],R=y.length/h;Ai(e,v,y,a,R,n.interpolate)}this.setReady()}disposeInternal(){const e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let t=0;t<this.textures.length;++t)e.deleteTexture(this.textures[t]);this.tile.removeEventListener(S.CHANGE,this.handleTileChange_)}getImagePixelData_(e,t,n){const i=this.gutter_,s=this.renderSize_[0],o=this.renderSize_[1];Ze||il(),Ze.clearRect(0,0,1,1);const a=e.width,l=e.height,h=a-2*i,c=l-2*i,u=i+Math.floor(h*(t/s)),d=i+Math.floor(c*(n/o));let g;try{Ze.drawImage(e,u,d,1,1,0,0,1,1),g=Ze.getImageData(0,0,1,1).data}catch{return Ze=null,null}return g}getArrayPixelData_(e,t,n,i){const s=this.gutter_,o=this.renderSize_[0],a=this.renderSize_[1],l=t[0],h=t[1],c=l+2*s,u=h+2*s,d=s+Math.floor(l*(n/o)),g=s+Math.floor(h*(i/a));if(e instanceof DataView){const _=e.byteLength/(c*u),p=_*(g*c+d),E=e.buffer.slice(p,p+_);return new DataView(E)}const f=this.bandCount*(g*c+d);return e.slice(f,f+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof xr){const n=this.tile.getData(),i=Rn(n);if(i){const s=this.tile.getSize();return this.getArrayPixelData_(i,s,e,t)}return this.getImagePixelData_(Dt(n),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}const vt={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},sl=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,ol=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class Si{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e.vertexShader||sl),t.compileShader(n);const i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,e.fragmentShader||ol),t.compileShader(i),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,n),t.attachShader(this.renderTargetProgram_,i),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(o=>{this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})})}getGL(){return this.gl_}init(e){const t=this.getGL(),n=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const i=0,s=t.RGBA,o=0,a=t.RGBA,l=t.UNSIGNED_BYTE,h=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,i,s,n[0],n[1],o,a,l,h),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n[0],n[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,n,i){const s=this.getGL(),o=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,t?t.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!t){const l=Y(s.canvas);if(!e.renderTargets[l]){const h=s.getContextAttributes();h&&h.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),n&&n(s,e),s.drawArrays(s.TRIANGLES,0,6),i&&i(s,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let n,i=1;this.uniforms_.forEach(function(s){if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof ImageData)s.texture||(s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${i}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,n.width,n.height,0,t.UNSIGNED_BYTE,new Uint8Array(n.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.uniform1i(s.location,i++);else if(Array.isArray(n))switch(n.length){case 2:t.uniform2f(s.location,n[0],n[1]);return;case 3:t.uniform3f(s.location,n[0],n[1],n[2]);return;case 4:t.uniform4f(s.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(s.location,n)})}}function Lr(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ar(r,e){return r[0]=e[0],r[1]=e[1],r[4]=e[2],r[5]=e[3],r[12]=e[4],r[13]=e[5],r}const Te={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},tt={UNSIGNED_BYTE:qa,UNSIGNED_SHORT:Qa,UNSIGNED_INT:Ja,FLOAT:wr},Ot={};function Pi(r){return"shared/"+r}let Di=0;function al(){const r="unique/"+Di;return Di+=1,r}function ll(r){let e=Ot[r];if(!e){const t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:el(t)},Ot[r]=e}return e.users+=1,e.context}function hl(r){const e=Ot[r];if(!e||(e.users-=1,e.users>0))return;const t=e.context,n=t.getExtension("WEBGL_lose_context");n&&n.loseContext();const i=t.canvas;i.width=1,i.height=1,delete Ot[r]}class cl extends Ft{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?Pi(e.canvasCacheKey):al(),this.gl_=ll(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(vt.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(vt.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=De(),this.offsetScaleMatrix_=De(),this.tmpMat4_=Lr(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(n=>new Si({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new Si({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===Pi(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,n=Y(e);let i=this.bufferCache_[n];if(!i){const s=t.createBuffer();i={buffer:e,webGlBuffer:s},this.bufferCache_[n]=i}t.bindBuffer(e.getType(),i.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=this.gl_,n=Y(e),i=this.bufferCache_[n];i&&!t.isContextLost()&&t.deleteBuffer(i.webGlBuffer),delete this.bufferCache_[n]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(vt.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(vt.RESTORED,this.boundHandleWebGLContextRestored_),hl(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,n){const i=this.gl_,s=this.getCanvas(),o=e.size,a=e.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,t?i.ZERO:i.ONE_MINUS_SRC_ALPHA),n?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindTexture(e,t,n){const i=this.gl_;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e),i.uniform1i(this.getUniformLocation(n),t)}prepareDrawToRenderTarget(e,t,n,i){const s=this.gl_,o=t.getSize();s.bindFramebuffer(s.FRAMEBUFFER,t.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,t.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,n?s.ZERO:s.ONE_MINUS_SRC_ALPHA),i?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(e,t){const n=this.gl_;this.getExtension("OES_element_index_uint");const i=n.UNSIGNED_INT,s=4,o=t-e,a=e*s;n.drawElements(n.TRIANGLES,o,i,a)}finalizeDraw(e,t,n){for(let i=0,s=this.postProcessPasses_.length;i<s;i++)i===s-1?this.postProcessPasses_[i].apply(e,null,t,n):this.postProcessPasses_[i].apply(e,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,n=e.viewState.rotation,i=e.pixelRatio;this.setUniformFloatValue(Te.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Te.ZOOM,e.viewState.zoom),this.setUniformFloatValue(Te.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(Te.PIXEL_RATIO,i),this.setUniformFloatVec2(Te.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(Te.ROTATION,n)}applyHitDetectionUniform(e){const t=this.getUniformLocation(Te.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(Te.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let n,i=0;this.uniforms_.forEach(s=>{if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData)s.texture||(s.prevValue=void 0,s.texture=t.createTexture()),this.bindTexture(s.texture,i,s.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),(!(n instanceof HTMLImageElement)||n.complete)&&s.prevValue!==n&&(s.prevValue=n,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),i++;else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(s.name,Ar(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:t.uniform2f(this.getUniformLocation(s.name),n[0],n[1]);return;case 3:t.uniform3f(this.getUniformLocation(s.name),n[0],n[1],n[2]);return;case 4:t.uniform4f(this.getUniformLocation(s.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(this.getUniformLocation(s.name),n)})}useProgram(e,t){this.gl_.useProgram(e),this.currentProgram_=e,this.applyFrameState(t),this.applyUniforms(t)}compileShader(e,t){const n=this.gl_,i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}getProgram(e,t){const n=this.gl_,i=this.compileShader(e,n.FRAGMENT_SHADER),s=this.compileShader(t,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,i),n.attachShader(o,s),n.linkProgram(o),!n.getShaderParameter(i,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(i)}`;throw new Error(a)}if(n.deleteShader(i),!n.getShaderParameter(s,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(a)}if(n.deleteShader(s),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(e){const t=Y(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=Y(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const n=e.size,i=e.viewState.rotation,s=e.viewState.resolution,o=e.viewState.center;return zt(t,0,0,2/(s*n[0]),2/(s*n[1]),-i,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,n,i,s){const o=this.getAttributeLocation(e);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,t,n,!1,i,s))}enableAttributes(e){const t=ul(e);let n=0;for(let i=0;i<e.length;i++){const s=e[i];this.enableAttributeArray_(s.name,s.size,s.type||wr,t,n),n+=s.size*Sr(s.type)}}handleWebGLContextLost(e){ct(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,n){const i=this.gl_;n=n||i.createTexture();const s=0,o=i.RGBA,a=0,l=i.RGBA,h=i.UNSIGNED_BYTE;return i.bindTexture(i.TEXTURE_2D,n),t?i.texImage2D(i.TEXTURE_2D,s,o,l,h,t):i.texImage2D(i.TEXTURE_2D,s,o,e[0],e[1],a,l,h,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),n}}function ul(r){let e=0;for(let t=0;t<r.length;t++){const n=r[t];e+=n.size*Sr(n.type)}return e}function Sr(r){switch(r){case tt.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case tt.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case tt.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case tt.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class Jn extends Fo{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=De(),this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(N.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(ne.PRECOMPOSE)){const i=new xt(ne.PRECOMPOSE,void 0,t,e);n.dispatchEvent(i)}}dispatchPostComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(ne.POSTCOMPOSE)){const i=new xt(ne.POSTCOMPOSE,void 0,t,e);n.dispatchEvent(i)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,n=-1,i;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const l=e.layerStatesArray[o].layer,h=l.getRenderer();if(!(h instanceof Jn)){t=!0;continue}const c=l.getClassName();if((t||c!==i)&&(n+=1,t=!1),i=c,h===this)break}const s="map/"+e.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new cl({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,n){const i=this.getLayer();if(i.hasListener(e)){zt(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const s=new xt(e,this.inversePixelTransform_,n,t);i.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(ne.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(ne.POSTRENDER,e,t)}}const dl={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},gl={};function Oi(r){return 1/(r+2)}function fl(){return{tileIds:new Set,representationsByZ:{}}}function Mi(r,e){return r.tileIds.has(Y(e))}function Ni(r,e,t){const n=r.representationsByZ;t in n||(n[t]=new Set),n[t].add(e),r.tileIds.add(Y(e.tile))}function hn(r,e){const t=r.layerStatesArray[r.layerIndex];t.extent&&(e=ce(e,Ke(t.extent,r.viewState.projection)));const n=t.layer.getRenderSource();if(!n.getWrapX()){const i=n.getTileGridForProjection(r.viewState.projection).getExtent();i&&(e=ce(e,i))}return e}function vn(r,e){return`${r.getKey()},${Ce(e)}`}class _l extends Jn{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=De(),this.tempMat4=Lr(),this.tempTileRange_=new Yn(0,0,0,0),this.tempTileCoord_=Pt(0,0,0),this.tempSize_=[0,0];const n=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new fr(n),this.frameState=null,this.projection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}isDrawableTile_(e){const t=this.getLayer(),n=e.getState(),i=t.getUseInterimTilesOnError();return n==x.LOADED||n==x.EMPTY||n==x.ERROR&&!i}prepareFrameInternal(e){this.projection_?e.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=e.viewState.projection):this.projection_=e.viewState.projection;const n=this.getLayer().getRenderSource();return!n||Nt(hn(e,e.extent))?!1:n.getState()==="ready"}createTileRepresentation(e){return k()}enqueueTiles(e,t,n,i,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=l.getGutterForProjection(o.projection),u=Y(l);u in e.wantedTiles||(e.wantedTiles[u]={});const d=e.wantedTiles[u],g=this.tileRepresentationCache,f=a.getMapInternal(),_=Math.max(n-s,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let p=n;p>=_;--p){const E=h.getTileRangeForExtentAndZ(t,p,this.tempTileRange_),m=h.getResolution(p);for(let v=E.minX;v<=E.maxX;++v)for(let y=E.minY;y<=E.maxY;++y){const R=Pt(p,v,y,this.tempTileCoord_),C=vn(l,R);let I,b;if(g.containsKey(C)&&(I=g.get(C),b=I.tile),(!I||I.tile.key!==l.getKey())&&(b=l.getTile(p,v,y,e.pixelRatio,o.projection)),Mi(i,b))continue;if(!I)I=this.createTileRepresentation({tile:b,grid:h,helper:this.helper,gutter:c}),g.set(C,I);else if(this.isDrawableTile_(b))I.setTile(b);else{const G=b.getInterimTile();I.setTile(G)}Ni(i,I,p);const O=b.getKey();d[O]=!0,b.getState()===x.IDLE&&(e.tileQueue.isKeyQueued(O)||e.tileQueue.enqueue([b,u,h.getTileCoordCenter(R),m]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,n,i,s,o,a,l,h,c,u){}renderTileMask(e,t,n,i){}drawTile_(e,t,n,i,s,o,a){if(!t.ready)return;const h=t.tile.tileCoord,c=Ce(h),u=c in o?o[c]:1,d=a.getResolution(n),g=he(a.getTileSize(n),this.tempSize_),f=a.getOrigin(n),_=a.getTileCoordExtent(h),p=u<1?-1:Oi(n);u<1&&(e.animate=!0);const E=e.viewState,m=E.center[0],v=E.center[1],y=g[0]+2*i,R=g[1]+2*i,C=y/R,I=(m-f[0])/(g[0]*d),b=(f[1]-v)/(g[1]*d),O=E.resolution/d,G=h[1],z=h[2];Rs(this.tileTransform_),ai(this.tileTransform_,2/(e.size[0]*O/y),-2/(e.size[1]*O/y)),vs(this.tileTransform_,E.rotation),ai(this.tileTransform_,1,1/C),xs(this.tileTransform_,(g[0]*(G-I)-i)/y,(g[1]*(z-b)-i)/R),this.renderTile(t,this.tileTransform_,e,s,d,g,f,_,p,i,u)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const n=e.viewState,i=this.getLayer(),s=i.getRenderSource(),o=s.getTileGridForProjection(n.projection),a=s.getGutterForProjection(n.projection),l=hn(e,e.extent),h=o.getZForResolution(n.resolution,s.zDirection),c=fl(),u=i.getPreload();if(e.nextExtent){const C=o.getZForResolution(n.nextResolution,s.zDirection),I=hn(e,e.nextExtent);this.enqueueTiles(e,I,C,c,u)}this.enqueueTiles(e,l,h,c,0),u>0&&setTimeout(()=>{this.enqueueTiles(e,l,h-1,c,u-1)},0);const d={},g=Y(this),f=e.time;let _=!1;for(const C of c.representationsByZ[h]){const I=C.tile;if((I instanceof Zt||I instanceof Cr)&&I.getState()===x.EMPTY)continue;const b=I.tileCoord;if(C.ready){const z=I.getAlpha(g,f);if(z===1){I.endTransition(g);continue}_=!0;const ie=Ce(b);d[ie]=z}if(this.renderComplete=!1,this.findAltTiles_(o,b,h+1,c))continue;const G=o.getMinZoom();for(let z=h-1;z>=G&&!this.findAltTiles_(o,b,z,c);--z);}const p=c.representationsByZ,E=Object.keys(p).map(Number).sort(hs);if(this.beforeTilesMaskRender(e))for(let C=0,I=E.length;C<I;++C){const b=E[C];for(const O of p[b]){const G=O.tile.tileCoord;if(Ce(G)in d)continue;const ie=o.getTileCoordExtent(G);this.renderTileMask(O,b,ie,Oi(b))}}this.beforeTilesRender(e,_);for(let C=0,I=E.length;C<I;++C){const b=E[C];for(const O of p[b]){const G=O.tile.tileCoord;Ce(G)in d||this.drawTile_(e,O,b,a,l,d,o)}}for(const C of p[h]){const I=C.tile.tileCoord;Ce(I)in d&&this.drawTile_(e,C,h,a,l,d,o)}this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const v=this.helper.getCanvas(),y=this.tileRepresentationCache;for(;y.canExpireCache();)y.pop().dispose();const R=function(C,I){s.updateCacheSize(.1,I.viewState.projection),s.expireCache(I.viewState.projection,gl)};return e.postRenderFunctions.push(R),this.postRender(t,e),v}findAltTiles_(e,t,n,i){const s=e.getTileRangeForTileCoordAndZ(t,n,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=s.minX;h<=s.maxX;++h)for(let c=s.minY;c<=s.maxY;++c){const u=vn(l,[n,h,c]);let d=!1;if(a.containsKey(u)){const g=a.get(u);g.ready&&!Mi(i,g.tile)&&(Ni(i,g,n),d=!0)}d||(o=!1)}return o}clearCache(){const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const A={...dl,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},Ct={TEXTURE_COORD:"a_textureCoord"},ml=[{name:Ct.TEXTURE_COORD,size:2,type:tt.FLOAT}];class pl extends _l{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new Ir(qn,Qn),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){super.reset(e),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(e){return new rl(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,n,i,s,o,a,l,h,c,u){const d=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(ml);let g=0;for(;g<e.textures.length;){const C=`${A.TILE_TEXTURE_ARRAY}[${g}]`;this.helper.bindTexture(e.textures[g],g,C),++g}for(let C=0;C<this.paletteTextures_.length;++C){const I=this.paletteTextures_[C],b=I.getTexture(d);this.helper.bindTexture(b,g,I.name),++g}const f=n.viewState,_=o[0]+2*c,p=o[1]+2*c,m=e.tile.tileCoord,v=m[1],y=m[2];this.helper.setUniformMatrixValue(A.TILE_TRANSFORM,Ar(this.tempMat4,t)),this.helper.setUniformFloatValue(A.TRANSITION_ALPHA,u),this.helper.setUniformFloatValue(A.DEPTH,h);let R=i;c>0&&(R=l,ce(R,i,R)),this.helper.setUniformFloatVec4(A.RENDER_EXTENT,R),this.helper.setUniformFloatValue(A.RESOLUTION,f.resolution),this.helper.setUniformFloatValue(A.ZOOM,f.zoom),this.helper.setUniformFloatValue(A.TEXTURE_PIXEL_WIDTH,_),this.helper.setUniformFloatValue(A.TEXTURE_PIXEL_HEIGHT,p),this.helper.setUniformFloatValue(A.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(A.TEXTURE_ORIGIN_X,a[0]+v*o[0]*s-c*s),this.helper.setUniformFloatValue(A.TEXTURE_ORIGIN_Y,a[1]-y*o[1]*s+c*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const n=this.frameState;if(!n)return null;const i=this.getLayer(),s=pn(n.pixelToCoordinateTransform,e.slice()),o=n.viewState,a=i.getExtent();if(a&&!wt(Ke(a,o.projection),s))return null;const l=i.getSources(mn([s]),o.resolution);let h,c,u;for(h=l.length-1;h>=0;--h)if(c=l[h],c.getState()==="ready"){if(u=c.getTileGridForProjection(o.projection),c.getWrapX())break;const g=u.getExtent();if(!g||wt(g,s))break}if(h<0)return null;const d=this.tileRepresentationCache;for(let g=u.getZForResolution(o.resolution);g>=u.getMinZoom();--g){const f=u.getTileCoordForCoordAndZ(s,g),_=vn(c,f);if(!d.containsKey(_))continue;const p=d.get(_),E=p.tile;if((E instanceof Zt||E instanceof Cr)&&E.getState()===x.EMPTY)return null;if(!p.loaded)continue;const m=u.getOrigin(g),v=he(u.getTileSize(g)),y=u.getResolution(g),R=(s[0]-m[0])/y-f[1]*v[0],C=(m[1]-s[1])/y-f[2]*v[1];return p.getPixelData(R,C)}return null}disposeInternal(){const e=this.helper;e&&(e.getGL().deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}class El{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}}function yl(r,e){return`operator_${r}_${Object.keys(e.functions).length}`}function Kt(r){const e=r.toString();return e.includes(".")?e:e+".0"}function Pr(r){if(r.length<2||r.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${r.length}(${r.map(Kt).join(", ")})`}function Tl(r){const e=nr(r),t=e.length>3?e[3]:1;return Pr([e[0]/255*t,e[1]/255*t,e[2]/255*t,t])}const cn={};let Rl=0;function Dr(r){return r in cn||(cn[r]=Rl++),cn[r]}function vl(r){return Kt(Dr(r))}function Or(r){return"u_var_"+r}function xl(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const un="getBandValue",Mr="u_paletteTextures";function Cl(r,e,t,n){const i=U(r,t,e);if(dt(i.type,Me))throw new Error("No matching type was found");if(!ue(e,i.type)){const s=B(e),o=B(i.type);throw new Error(`Expected expression to be of type ${s}, got ${o}`)}return ei(i,e,n)}function D(r){return(e,t,n)=>{const i=t.args.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=ei(t.args[o],n,e);return r(s,e)}}const wl={[T.Get]:(r,e)=>{const n=e.args[0].value;return n in r.properties||(r.properties[n]={name:n,type:e.type}),(r.inFragmentShader?"v_prop_":"a_prop_")+n},[T.GeometryType]:(r,e,t)=>{const n="geometryType",i=a=>{const l=a.getType();switch(l){case"Point":case"LineString":case"Polygon":return l;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return l.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return i(a.getGeometries()[0])}};return n in r.properties||(r.properties[n]={name:n,type:oe,evaluator:a=>i(a.getGeometry())}),(r.inFragmentShader?"v_prop_":"a_prop_")+n},[T.Var]:(r,e)=>{const n=e.args[0].value;return n in r.variables||(r.variables[n]={name:n,type:e.type}),Or(n)},[T.Resolution]:()=>"u_resolution",[T.Zoom]:()=>"u_zoom",[T.Time]:()=>"u_time",[T.Any]:D(r=>`(${r.join(" || ")})`),[T.All]:D(r=>`(${r.join(" && ")})`),[T.Not]:D(([r])=>`(!${r})`),[T.Equal]:D(([r,e])=>`(${r} == ${e})`),[T.NotEqual]:D(([r,e])=>`(${r} != ${e})`),[T.GreaterThan]:D(([r,e])=>`(${r} > ${e})`),[T.GreaterThanOrEqualTo]:D(([r,e])=>`(${r} >= ${e})`),[T.LessThan]:D(([r,e])=>`(${r} < ${e})`),[T.LessThanOrEqualTo]:D(([r,e])=>`(${r} <= ${e})`),[T.Multiply]:D(r=>`(${r.join(" * ")})`),[T.Divide]:D(([r,e])=>`(${r} / ${e})`),[T.Add]:D(r=>`(${r.join(" + ")})`),[T.Subtract]:D(([r,e])=>`(${r} - ${e})`),[T.Clamp]:D(([r,e,t])=>`clamp(${r}, ${e}, ${t})`),[T.Mod]:D(([r,e])=>`mod(${r}, ${e})`),[T.Pow]:D(([r,e])=>`pow(${r}, ${e})`),[T.Abs]:D(([r])=>`abs(${r})`),[T.Floor]:D(([r])=>`floor(${r})`),[T.Ceil]:D(([r])=>`ceil(${r})`),[T.Round]:D(([r])=>`floor(${r} + 0.5)`),[T.Sin]:D(([r])=>`sin(${r})`),[T.Cos]:D(([r])=>`cos(${r})`),[T.Atan]:D(([r,e])=>e!==void 0?`atan(${r}, ${e})`:`atan(${r})`),[T.Sqrt]:D(([r])=>`sqrt(${r})`),[T.Match]:D(r=>{const e=r[0],t=r[r.length-1];let n=null;for(let i=r.length-3;i>=1;i-=2){const s=r[i],o=r[i+1];n=`(${e} == ${s} ? ${o} : ${n||t})`}return n}),[T.Between]:D(([r,e,t])=>`(${r} >= ${e} && ${r} <= ${t})`),[T.Interpolate]:D(([r,e,...t])=>{let n="";for(let i=0;i<t.length-2;i+=2){const s=t[i],o=n||t[i+1],a=t[i+2],l=t[i+3];let h;r===Kt(1)?h=`(${e} - ${s}) / (${a} - ${s})`:h=`(pow(${r}, (${e} - ${s})) - 1.0) / (pow(${r}, (${a} - ${s})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${h}, 0.0, 1.0))`}return n}),[T.Case]:D(r=>{const e=r[r.length-1];let t=null;for(let n=r.length-3;n>=0;n-=2){const i=r[n],s=r[n+1];t=`(${i} ? ${s} : ${t||e})`}return t}),[T.In]:D(([r,...e],t)=>{const n=yl("in",t),i=[];for(let s=0;s<e.length;s+=1)i.push(`  if (inputValue == ${e[s]}) { return true; }`);return t.functions[n]=`bool ${n}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${n}(${r})`}),[T.Array]:D(r=>`vec${r.length}(${r.join(", ")})`),[T.Color]:D(r=>{const e=r.slice(0,3).map(n=>`${n} / 255.0`);return r.length===3?`vec4(${e.join(", ")}, 1.0)`:`(${r[3]} * vec4(${e.join(", ")}, 1.0))`}),[T.Band]:D(([r,e,t],n)=>{if(!(un in n.functions)){let i="";const s=n.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const h=`${A.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${o+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[un]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${A.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${A.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${un}(${r}, ${e??"0.0"}, ${t??"0.0"})`}),[T.Palette]:(r,e)=>{const[t,...n]=e.args,i=n.length,s=new Uint8Array(i*4);for(let h=0;h<n.length;h++){const c=n[h].value,u=nr(c),d=h*4;s[d]=u[0],s[d+1]=u[1],s[d+2]=u[2],s[d+3]=u[3]*255}r.paletteTextures||(r.paletteTextures=[]);const o=`${Mr}[${r.paletteTextures.length}]`,a=new El(o,s);r.paletteTextures.push(a);const l=ei(t,w,r);return`texture2D(${o}, vec2((${l} + 0.5) / ${i}.0, 0.5))`}};function ei(r,e,t){if(r instanceof ar){const n=wl[r.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(r.operator)}`);return n(t,r,e)}if((r.type&w)>0)return Kt(r.value);if((r.type&K)>0)return r.value.toString();if((r.type&oe)>0)return vl(r.value.toString());if((r.type&W)>0)return Tl(r.value);if((r.type&Ye)>0)return Pr(r.value);throw new Error(`Unexpected expression ${r.value} (expected type ${B(e)})`)}function ze(r,e,t){const n=xo();return n.style=r.style,Cl(e,t,n,r)}function Fi(r,e){const t=`
    attribute vec2 ${Ct.TEXTURE_COORD};
    uniform mat4 ${A.TILE_TRANSFORM};
    uniform float ${A.TEXTURE_PIXEL_WIDTH};
    uniform float ${A.TEXTURE_PIXEL_HEIGHT};
    uniform float ${A.TEXTURE_RESOLUTION};
    uniform float ${A.TEXTURE_ORIGIN_X};
    uniform float ${A.TEXTURE_ORIGIN_Y};
    uniform float ${A.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${Ct.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${A.TEXTURE_ORIGIN_X} + ${A.TEXTURE_RESOLUTION} * ${A.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${A.TEXTURE_ORIGIN_Y} - ${A.TEXTURE_RESOLUTION} * ${A.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${A.TILE_TRANSFORM} * vec4(${Ct.TEXTURE_COORD}, ${A.DEPTH}, 1.0);
    }
  `,n={...xl(),inFragmentShader:!0,bandCount:e,style:r},i=[];if(r.color!==void 0){const u=ze(n,r.color,W);i.push(`color = ${u};`)}if(r.contrast!==void 0){const u=ze(n,r.contrast,w);i.push(`color.rgb = clamp((${u} + 1.0) * color.rgb - (${u} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.exposure!==void 0){const u=ze(n,r.exposure,w);i.push(`color.rgb = clamp((${u} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.saturation!==void 0){const u=ze(n,r.saturation,w);i.push(`
      float saturation = ${u} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(r.gamma!==void 0){const u=ze(n,r.gamma,w);i.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${u}));`)}if(r.brightness!==void 0){const u=ze(n,r.brightness,w);i.push(`color.rgb = clamp(color.rgb + ${u}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(n.variables).length;if(o>1&&!r.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let u=0;u<o;++u){const d=n.variables[Object.keys(n.variables)[u]];if(!(d.name in r.variables))throw new Error(`Missing '${d.name}' in style variables`);const g=Or(d.name);s[g]=function(){let f=r.variables[d.name];return typeof f=="string"&&(f=Dr(f)),f!==void 0?f:-9999999}}const a=Object.keys(s).map(function(u){return`uniform float ${u};`}),l=Math.ceil(e/4);a.push(`uniform sampler2D ${A.TILE_TEXTURE_ARRAY}[${l}];`),n.paletteTextures&&a.push(`uniform sampler2D ${Mr}[${n.paletteTextures.length}];`);const h=Object.keys(n.functions).map(function(u){return n.functions[u]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${A.RENDER_EXTENT};
    uniform float ${A.TRANSITION_ALPHA};
    uniform float ${A.TEXTURE_PIXEL_WIDTH};
    uniform float ${A.TEXTURE_PIXEL_HEIGHT};
    uniform float ${A.RESOLUTION};
    uniform float ${A.ZOOM};

    ${a.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${A.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${A.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${A.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${A.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${A.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${i.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${A.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:c,uniforms:s,paletteTextures:n.paletteTextures}}class ti extends $a{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style;const n=e.cacheSize;delete e.cacheSize,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.cacheSize_=n,this.styleVariables_=this.style_.variables||{},this.addChangeListener(N.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=Fi(this.style_,this.getSourceBandCount_());return new pl(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})}renderSources(e,t){const n=this.getRenderer();let i;for(let s=0,o=t.length;s<o;++s)this.renderedSource_=t[s],n.prepareFrame(e)&&(i=n.renderFrame(e));return i}render(e,t){this.rendered=!0;const n=e.viewState,i=this.getSources(e.extent,n.resolution);let s=!0;for(let a=0,l=i.length;a<l;++a){const h=i[a],c=h.getState();if(c=="loading"){const u=()=>{h.getState()=="ready"&&(h.removeEventListener("change",u),this.changed())};h.addEventListener("change",u)}s=s&&c=="ready"}const o=this.renderSources(e,i);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=n.resolution,o;if(this.renderedResolution_>.5*n.resolution){const a=this.getSources(e.extent,this.renderedResolution_).filter(l=>!i.includes(l));if(a.length>0)return this.renderSources(e,a)}return o}setStyle(e){this.styleVariables_=e.variables||{},this.style_=e;const t=Fi(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}ti.prototype.dispose;const Al=({map:r,target:e})=>{r.setTarget(e);const t=new Ka,n=new ti({source:t});r.addLayer(n);const i=new le({center:as([19.68,53.661]),zoom:18,projection:"EPSG:2178"});r.setView(i)},Sl=({url:r})=>{const[e,t]=Ht.useState("UNSET"),[n,i]=Ht.useState();return Ht.useEffect(()=>{t("PENDING"),fetch(r).then(s=>s.json()).then(s=>{i(s),t("SUCCESS")}).catch(s=>{t("FAILED"),console.error({err:s})})},[r]),{status:e,data:n}},Il=({meta:r})=>{const e=r.minX||0,t=r.maxX||0,n=r.minY||0,i=r.maxY||0,s=[Number(e+t)/2,Number(n+i)/2];return{extent:[e,n,t,i],maxX:t,maxY:i,minX:e,minY:n,origin:[e,i],resolutions:r.resolutions??[],maxResolution:Math.max(...r.resolutions),minResolution:Math.min(...r.resolutions),tileSize:[r.tileSize??512,r.tileSize??512],center:[s[0],s[1]]}},Pl=({map:r,metadata:e,url:t,originZero:n})=>{const{extent:i,origin:s,resolutions:o,tileSize:a,center:l}=Il({meta:e}),h=new Bn({extent:i,origin:n?[0,0]:s,resolutions:o,tileSize:a}),c=new vr({tileGrid:h,url:t,crossOrigin:"anonymous",projection:"EPSG:2178"}),u=new ti({source:c});r.addLayer(u),console.log({tileLayer:u}),r.getView().setCenter(l)};export{Ll as M,Pl as a,Al as c,Sl as u};
